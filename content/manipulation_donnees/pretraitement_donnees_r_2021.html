---
title: "Prétraitement de données en R"
author: "Sophie Baillargeon, Université Laval"
date: "2021-02-11"
weight: 3
slug: "pretraitement_donnees_r"
lastmodifierdisplayname: "Sophie Baillargeon"
lastmodifieremail: "sophie.baillargeon@mat.ulaval.ca"
output:
  pdf_document:
    toc: yes
    toc_depth: 3
    number_sections: yes
    highlight: tango
  blogdown::html_page:
    toc: yes
    toc_depth: 3
    number_sections: yes
    highlight: tango
header-includes:
- \usepackage[french]{babel}
- \frenchbsetup{StandardLayout}
- \hypersetup{colorlinks=true, urlcolor = {blue}, linkcolor = {blue}}
- \usepackage{ragged2e}
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#transformations-de-variables"><span class="toc-section-number">1</span> Transformations de variables</a>
<ul>
<li><a href="#modification-ou-ajout-de-variables"><span class="toc-section-number">1.1</span> Modification ou ajout de variables</a>
<ul>
<li><a href="#opérateurs-dindiçage-et-fonction-transform"><span class="toc-section-number">1.1.1</span> Opérateurs d’indiçage et fonction <code>transform</code></a></li>
<li><a href="#fonction-mutate-du-package-dplyr"><span class="toc-section-number">1.1.2</span> Fonction <code>mutate</code> du package <code>dplyr</code></a></li>
<li><a href="#opérateur-du-package-data.table"><span class="toc-section-number">1.1.3</span> Opérateur <code>:=</code> du package <code>data.table</code></a></li>
</ul></li>
<li><a href="#variable-conditionnelle-à-une-autre-avec-la-fonction-ifelse"><span class="toc-section-number">1.2</span> Variable conditionnelle à une autre avec la fonction <code>ifelse</code></a></li>
<li><a href="#catégorisation-dune-variable-numérique"><span class="toc-section-number">1.3</span> Catégorisation d’une variable numérique</a>
<ul>
<li><a href="#fonction-cut"><span class="toc-section-number">1.3.1</span> Fonction <code>cut</code> :</a></li>
<li><a href="#fonction-case_when-du-package-dplyr"><span class="toc-section-number">1.3.2</span> Fonction <code>case_when</code> du package <code>dplyr</code></a></li>
<li><a href="#fonction-ave"><span class="toc-section-number">1.3.3</span> Fonction <code>ave</code> :</a></li>
</ul></li>
<li><a href="#normalisation-de-valeurs-numériques"><span class="toc-section-number">1.4</span> Normalisation de valeurs numériques</a>
<ul>
<li><a href="#fonction-scale"><span class="toc-section-number">1.4.1</span> Fonction <code>scale</code></a></li>
</ul></li>
<li><a href="#manipulation-de-chaînes-de-caractères"><span class="toc-section-number">1.5</span> Manipulation de chaînes de caractères</a>
<ul>
<li><a href="#fonction-paste"><span class="toc-section-number">1.5.1</span> Fonction <code>paste</code> :</a></li>
<li><a href="#fonction-nchar"><span class="toc-section-number">1.5.2</span> Fonction <code>nchar</code> :</a></li>
<li><a href="#fonctions-toupper-tolower-et-casefold"><span class="toc-section-number">1.5.3</span> Fonctions <code>toupper</code>, <code>tolower</code> et <code>casefold</code> :</a></li>
<li><a href="#fonction-strsplit"><span class="toc-section-number">1.5.4</span> Fonction <code>strsplit</code> :</a></li>
<li><a href="#fonction-substr"><span class="toc-section-number">1.5.5</span> Fonction <code>substr</code> :</a></li>
<li><a href="#fonctions-sub-et-gsub"><span class="toc-section-number">1.5.6</span> Fonctions <code>sub</code> et <code>gsub</code> :</a></li>
<li><a href="#fonctions-grep-et-grepl"><span class="toc-section-number">1.5.7</span> Fonctions <code>grep</code> et <code>grepl</code> :</a></li>
<li><a href="#fonction-chartr"><span class="toc-section-number">1.5.8</span> Fonction <code>chartr</code> :</a></li>
<li><a href="#fonction-iconv"><span class="toc-section-number">1.5.9</span> Fonction <code>iconv</code> :</a></li>
<li><a href="#package-stringr"><span class="toc-section-number">1.5.10</span> Package <code>stringr</code></a></li>
</ul></li>
<li><a href="#manipulation-de-dates"><span class="toc-section-number">1.6</span> Manipulation de dates</a>
<ul>
<li><a href="#fonctions-as.date-et-sys.getlocale"><span class="toc-section-number">1.6.1</span> Fonctions <code>as.Date</code> et <code>Sys.getlocale</code></a></li>
<li><a href="#fonctions-difftime-et-sys.date"><span class="toc-section-number">1.6.2</span> Fonctions <code>difftime</code> et <code>Sys.Date</code></a></li>
<li><a href="#fonction-format"><span class="toc-section-number">1.6.3</span> Fonction <code>format</code></a></li>
<li><a href="#package-lubridate"><span class="toc-section-number">1.6.4</span> Package <code>lubridate</code></a></li>
</ul></li>
</ul></li>
<li><a href="#manipulation-de-jeux-de-données"><span class="toc-section-number">2</span> Manipulation de jeux de données</a>
<ul>
<li><a href="#omission-dobservations"><span class="toc-section-number">2.1</span> Omission d’observations</a>
<ul>
<li><a href="#retrait-des-observations-dupliquées"><span class="toc-section-number">2.1.1</span> Retrait des observations dupliquées</a></li>
<li><a href="#retrait-des-observations-avec-données-manquantes"><span class="toc-section-number">2.1.2</span> Retrait des observations avec données manquantes</a></li>
</ul></li>
<li><a href="#sélection-de-sous-ensembles-de-données"><span class="toc-section-number">2.2</span> Sélection de sous-ensembles de données</a>
<ul>
<li><a href="#opérateur-et-fonction-subset"><span class="toc-section-number">2.2.1</span> Opérateur <code>[</code> et fonction <code>subset</code></a></li>
<li><a href="#fonctions-filter-et-select-du-package-dplyr"><span class="toc-section-number">2.2.2</span> Fonctions <code>filter</code> et <code>select</code> du package <code>dplyr</code></a></li>
<li><a href="#opérateur-et-fonction-subset-du-package-data.table"><span class="toc-section-number">2.2.3</span> Opérateur <code>[</code> et fonction <code>subset</code> du package <code>data.table</code></a></li>
</ul></li>
<li><a href="#combinaison-de-données"><span class="toc-section-number">2.3</span> Combinaison de données</a>
<ul>
<li><a href="#concaténation-dobservations-lignes---fonction-rbind"><span class="toc-section-number">2.3.1</span> Concaténation d’observations (lignes) - Fonction <code>rbind</code></a></li>
<li><a href="#concaténation-de-variables-colonnes---fonction-cbind-ou-data.table"><span class="toc-section-number">2.3.2</span> Concaténation de variables (colonnes) - Fonction <code>cbind</code> ou <code>data.table</code></a></li>
<li><a href="#fusion-par-association---fonction-merge"><span class="toc-section-number">2.3.3</span> Fusion par association - Fonction <code>merge</code></a></li>
<li><a href="#fonctions-de-concaténation-et-de-jointure-du-package-dplyr"><span class="toc-section-number">2.3.4</span> Fonctions de concaténation et de jointure du package <code>dplyr</code></a></li>
<li><a href="#fonctions-rbindlist-et-merge-du-package-data.table"><span class="toc-section-number">2.3.5</span> Fonctions <code>rbindlist</code> et <code>merge</code> du package <code>data.table</code></a></li>
</ul></li>
<li><a href="#modification-de-lordre-des-données"><span class="toc-section-number">2.4</span> Modification de l’ordre des données</a>
<ul>
<li><a href="#fonction-rev"><span class="toc-section-number">2.4.1</span> Fonction <code>rev</code></a></li>
<li><a href="#fonction-sort"><span class="toc-section-number">2.4.2</span> Fonction <code>sort</code></a></li>
<li><a href="#opérateur"><span class="toc-section-number">2.4.3</span> Opérateur <code>[</code></a></li>
<li><a href="#fonction-order"><span class="toc-section-number">2.4.4</span> Fonction <code>order</code></a></li>
<li><a href="#fonction-arrange-du-package-dplyr"><span class="toc-section-number">2.4.5</span> Fonction <code>arrange</code> du package <code>dplyr</code></a></li>
<li><a href="#fonctions-setorder-et-setcolorder-du-package-data.table"><span class="toc-section-number">2.4.6</span> Fonctions <code>setorder</code> et <code>setcolorder</code> du package <code>data.table</code></a></li>
</ul></li>
<li><a href="#changement-de-mise-en-forme-de-jeux-de-données"><span class="toc-section-number">2.5</span> Changement de mise en forme de jeux de données</a>
<ul>
<li><a href="#transposition-avec-la-fonction-t"><span class="toc-section-number">2.5.1</span> Transposition avec la fonction <code>t</code></a></li>
<li><a href="#comparaison-des-mises-en-forme-large-et-longue"><span class="toc-section-number">2.5.2</span> Comparaison des mises en forme large et longue</a></li>
<li><a href="#fonctions-stack-et-unstack"><span class="toc-section-number">2.5.3</span> Fonctions <code>stack</code> et <code>unstack</code></a></li>
<li><a href="#fonction-reshape"><span class="toc-section-number">2.5.4</span> Fonction <code>reshape</code></a></li>
<li><a href="#fonctions-pivot_longer-et-pivot_wider-du-package-tidyr"><span class="toc-section-number">2.5.5</span> Fonctions <code>pivot_longer</code> et <code>pivot_wider</code> du package <code>tidyr</code></a></li>
<li><a href="#fonctions-melt-et-dcast-du-package-data.table"><span class="toc-section-number">2.5.6</span> Fonctions <code>melt</code> et <code>dcast</code> du package <code>data.table</code></a></li>
</ul></li>
</ul></li>
<li><a href="#résumé"><span class="toc-section-number">3</span> Résumé</a></li>
<li><a href="#références">Références</a></li>
<li><a href="#annexe">Annexe</a>
<ul>
<li><a href="#exemples-supplémentaires-de-changement-de-mise-en-forme">Exemples supplémentaires de changement de mise en forme</a></li>
</ul></li>
</ul>
</div>

<hr />
<p><em>Note préliminaire : Lors de leur dernière mise à jour, ces notes ont été révisées en utilisant R version 4.0.3, le package <code>dplyr</code> version 1.0.3, le package <code>tidyr</code> version 1.1.2, le package <code>data.table</code> version 1.13.6, le package <code>stringr</code> version 1.4.0 et le package <code>lubridate</code> version 1.7.9.2. Pour d’autres versions, les informations peuvent différer.</em></p>
<hr />
<p>Maintenant que nous savons comment créer un objet contenant les données que nous voulons analyser, il nous reste un volet à couvrir dans la manipulation de données en R : le prétraitement des données. Ce prétraitement est défini ici comme étant toutes les étapes nécessaires pour rendre des données prêtes à être fournies en entrée à une certaine fonction, par exemple une fonction pour produire un graphique ou ajuster un modèle. Un jeu de données brut doit, dans la grande majorité des cas, être adapté afin d’être analysable. Préparer des données peut impliquer :</p>
<ul>
<li>nettoyer les données (repérer et corriger des erreurs);</li>
<li>modifier les observations d’une variable;</li>
<li>créer de nouvelles variables;</li>
<li>mettre en commun des jeux de données;</li>
<li>réordonner des observations;</li>
<li>modifier la mise en forme d’un jeu de données;</li>
<li>etc.</li>
</ul>
<p>Voici comment réaliser certains de ces prétraitements en R. La façon de procéder avec les packages chargés par défaut lors de l’ouverture d’une session R (principalement les packages <code>base</code> et <code>stats</code>) est présentée en détail. Des façons de réaliser certaines tâches avec des packages du <a href="https://www.tidyverse.org/"><code>tidyverse</code></a> (principalement les packages <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> et <a href="https://tidyr.tidyverse.org/"><code>tidyr</code></a>), ainsi qu’avec le package <a href="http://r-datatable.com"><code>data.table</code></a>, sont également mentionnées, sans être approfondies. Chargeons donc ces packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<p>De façon générale, les packages du <code>tidyverse</code> présentent l’avantage d’être cohérents entre eux et abondamment documentés sur le web (en partie en raison de leur popularité). Pour sa part, la grande force du package <code>data.table</code> est sa capacité à effectuer rapidement des traitements, même sur des jeux de données de grande taille. Les packages du <code>tidyverse</code> tendent aussi à être un peu plus rapide que le R de base, mais pas aussi rapide que le package <code>data.table</code>. Malgré des différences en ce qui concerne les temps d’exécution, les trois options présentées ici (R de base versus <code>tidyverse</code> versus <code>data.table</code>) produisent des résultats équivalents. Ainsi, dans un cas de manipulation de données dont la taille n’est pas trop grande, le choix entre ces outils est uniquement une question de goût.</p>
<p>Ces notes se terminent en présentant trois différentes avenues pour comparer des objets R. Lors de la réalisation de prétraitement de données, il est fréquemment de vouloir comparer des structures de données, dans leur entièreté ou en partie, afin de s’assurer d’avoir correctement effectué les manipulations requises.</p>
<hr />
<div id="transformations-de-variables" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Transformations de variables</h1>
<p>Un grand nombre de transformations de variables usuelles peuvent être facilement réalisées en R, par exemple les transformations suivantes :</p>
<ul>
<li>conversion de format de données,</li>
<li>modification de chaînes de caractères (p. ex. remplacement ou retrait des caractères, modification de la casse (majuscule ou minuscule))</li>
<li>extraction d’une sous-chaîne de caractères,</li>
<li>changement de libellés pour les niveaux d’un facteur,</li>
<li>regroupement des niveaux d’un facteur,</li>
<li>transformation mathématique de variables numériques (p. ex. normalisation de valeurs),</li>
<li>arrondissement ou troncature de valeurs numériques,</li>
<li>etc.</li>
</ul>
<p>Les transformations de variables peuvent mener à des modifications des variables dans un jeu de données ou en la création de nouvelles variables à partir de celles existantes.</p>
<p>Supposons ici que nous travaillons avec un jeu de données stocké dans un data frame R. Les colonnes du data frame représentent des variables. Pour illustrer les premières transformations présentées, nous utiliserons le jeu de données <code>cars</code> du package <code>dataset</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  2 variables:
##  $ speed: num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist : num  2 10 4 22 16 10 18 26 34 17 ...</code></pre>
<p>Il s’agit d’un petit jeu de données à 50 observations prises sur des voitures et 2 variables :</p>
<ul>
<li><code>speed</code> : la vitesse de déplacement des voitures tout juste avant de freiner, mesurée en miles par heure;</li>
<li><code>dist</code> : la distance parcourue par ces voitures entre le moment d’un freinage et l’atteinte d’une immobilisation complète, mesurée en pieds.</li>
</ul>
<div id="modification-ou-ajout-de-variables" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Modification ou ajout de variables</h2>
<div id="opérateurs-dindiçage-et-fonction-transform" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Opérateurs d’indiçage et fonction <code>transform</code></h3>
<p>Pour remplacer une variable dans un data frame par une transformation de celle-ci, il suffit d’assigner le nouveau vecteur ou facteur contenant les observations de la variable transformée à la colonne contenant la variable à modifier.</p>
<p>Par exemple, dans le jeu de données <code>cars</code>, la distance est exprimée en pieds. Supposons que nous voulons transformer l’échelle de mesure de cette variable pour des mètres. Cette transformation est effectuée par une simple opération mathématique : la multiplication par un facteur de conversion. Ce facteur de conversion est ici 0.3048, car un pied est l’équivalent de 0.3048 mètre.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>dist <span class="sc">*</span> <span class="fl">0.3048</span></span></code></pre></div>
<p>Pour modifier la variable sans en créer une nouvelle, il suffit d’assigner le vecteur contenant les données pour la variable transformée à la colonne qui contenait la variable d’origine.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>dist <span class="ot">&lt;-</span> cars<span class="sc">$</span>dist <span class="sc">*</span> <span class="fl">0.3048</span></span></code></pre></div>
<p>Nous savons que l’instruction <code>cars$dist</code>, servant à identifier la colonne à modifier, aurait pu être écrite de bien d’autres façons, notamment :</p>
<ul>
<li><code>cars[["dist"]]</code></li>
<li><code>cars[, "dist"]</code></li>
<li><code>cars[, 2]</code></li>
<li>etc.</li>
</ul>
<p>Je considère cependant que l’opérateur <code>$</code> procure la syntaxe la plus simple pour un remplacement de variable dans un data frame. Le jeu de données <code>cars</code> a été modifié comme suit.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  2 variables:
##  $ speed: num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist : num  0.61 3.05 1.22 6.71 4.88 ...</code></pre>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/transform.html">fonction <code>transform</code></a> offre une autre façon d’écrire ce genre d’assignation. La commande suivante produit le même résultat que la dernière assignation.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">transform</span>(cars, <span class="at">dist =</span> dist <span class="sc">*</span> <span class="fl">0.3048</span>)</span></code></pre></div>
<p>Il faut donner comme premier argument à la fonction <code>transform</code> le data frame dans lequel nous souhaitons effectuer une transformation de variable. Les arguments suivants sont des assignations de nouvelles valeurs. Dans ces assignations, il est possible de référer aux colonnes du data frame fourni comme premier argument par leur nom sans les précéder de <code>nom_du_data_frame$</code> et sans les encadrer de guillemets, comme avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/subset.html">fonction <code>subset</code></a>, vue dans le <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#fonctions-dextraction">cours sur les structures de données en R</a>.</p>
<p>Plutôt que d’écraser une colonne d’un data frame en la remplaçant par un autre objet, comme nous venons de le faire, il sera souvent préférable d’ajouter les nouvelles variables créées tout en conservant les anciennes. Dans ce cas, il suffit de concaténer les nouvelles variables au data frame avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/cbind.html">fonction <code>cbind</code></a> ou <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/data.frame.html"><code>data.frame</code></a>, ou d’assigner les nouvelles variables à des colonnes portant des noms qui ne sont pas initialement présents dans le data frame. Par exemple, pour ajouter une variable contenant la distance exprimée en mètres au data frame <code>cars</code>, nous pourrions procéder comme suit.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> datasets<span class="sc">::</span>cars  <span class="co"># pour repartir avec la version originale du jeu de données</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>dist_m <span class="ot">&lt;-</span> cars<span class="sc">$</span>dist <span class="sc">*</span> <span class="fl">0.3048</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cars)</span></code></pre></div>
<pre><code>##   speed dist dist_m
## 1     4    2 0.6096
## 2     4   10 3.0480
## 3     7    4 1.2192
## 4     7   22 6.7056
## 5     8   16 4.8768
## 6     9   10 3.0480</code></pre>
<p>Étant donné que le jeu de données <code>cars</code> ne contenait pas à l’origine de colonne nommée <code>dist_m</code>, une nouvelle colonne portant ce nom a été créée et ajoutée après les colonnes déjà présentes dans le data frame. La même tâche aurait pu être effectuée en utilisant en appelant la fonction <code>cbind</code> ou <code>data.frame</code> comme suit.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(cars, <span class="at">dist_m =</span> cars<span class="sc">$</span>dist <span class="sc">*</span> <span class="fl">0.3048</span>)</span></code></pre></div>
<p>La fonction <code>transform</code> permet aussi d’ajouter de nouvelles variables par une assignation à un nouveau nom de colonne.</p>
<p><strong>Remarque</strong> : Il y a souvent plusieurs façons de réaliser une même tâche en R. Personnellement, je tends à adopter la façon qui présente le meilleur compromis entre un code le plus facile à comprendre possible et un code le plus court possible. Ici, l’assignation à un nouveau nom de colonne avec l’opérateur <code>$</code> me semble la meilleure option.</p>
</div>
<div id="fonction-mutate-du-package-dplyr" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Fonction <code>mutate</code> du package <code>dplyr</code></h3>
<p>Pour les adeptes du <code>tidyverse</code>, le package <code>dplyr</code> propose, entre autres, la fonction <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate</code></a> pour modifier ou créer de nouvelles variables. L’opération précédente aurait pu être effectuée comme suit avec cette fonction, dont l’utilisation ressemble à celle de la fonction <code>transform</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">mutate</span>(cars, <span class="at">dist_m =</span> dist <span class="sc">*</span> <span class="fl">0.3048</span>)</span></code></pre></div>
</div>
<div id="opérateur-du-package-data.table" class="section level3" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Opérateur <code>:=</code> du package <code>data.table</code></h3>
<p>Si le data frame contenant les données à manipuler est d’abord transformé en data table, déjà mentionné dans les notes sur les <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#data-tables">structures de données</a>, l’<a href="https://rdatatable.gitlab.io/data.table/articles/datatable-reference-semantics.html#addupdatedelete-columns-by-reference">opérateur d’assignation <code>:=</code></a> offert par le package <code>data.table</code> peut ensuite être utilisé pour ajouter, modifier ou même effacer des variables dans les données. Cet opérateur s’utilise en conjonction avec l’opérateur, <code>[</code> comme dans l’exemple suivant.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cars_dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(datasets<span class="sc">::</span>cars)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>cars_dt[, dist_m <span class="sc">:</span><span class="er">=</span> dist <span class="sc">*</span> <span class="fl">0.3048</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars_dt)</span></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   50 obs. of  3 variables:
##  $ speed : num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist  : num  2 10 4 22 16 10 18 26 34 17 ...
##  $ dist_m: num  0.61 3.05 1.22 6.71 4.88 ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>Avec <code>:=</code>, aucune copie de l’objet n’est effectuée pour ensuite être réassignée. L’objet est modifié par référence (donc « sur place »), ce qui n’est pas le cas pour toutes les autres façons de faire présentées précédemment. La modification d’objets par référence est une des techniques utilisées par le package <code>data.table</code> pour optimiser ses temps de traitement.</p>
</div>
</div>
<div id="variable-conditionnelle-à-une-autre-avec-la-fonction-ifelse" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Variable conditionnelle à une autre avec la fonction <code>ifelse</code></h2>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/ifelse.html">fonction <code>ifelse</code></a> est souvent utile pour transformer des variables. Cette fonction prend comme premier argument un vecteur de valeurs logiques. Cet argument est nommé <code>test</code>. Elle retourne en sortie un vecteur de même longueur que <code>test</code>. Ce vecteur est formé des valeurs dans le deuxième argument (<code>yes</code>) aux positions pour lesquelles <code>test</code> comporte une valeur <code>TRUE</code>, et des valeurs dans le troisième argument (<code>no</code>) aux autres positions. Voici un petit exemple pour comprendre le fonctionnement de cette fonction.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">yes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">no =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">3</span> , <span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1]  1 -2 -3  4</code></pre>
<p>Par exemple, supposons que nous souhaitons créer une nouvelle variable dans le jeu de données <code>cars</code> contenant la vitesse en km/heure plutôt qu’en miles/heure, mais dans laquelle les valeurs de distance en miles à l’heure inférieures à 10 sont ramenées à des valeurs manquantes. Nous pourrions créer cette variable comme suit (1.60934 est le facteur de conversion entre un mile à l’heure et un kilomètre à l’heure).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>speed_km <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="at">test =</span> cars<span class="sc">$</span>speed <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="at">yes =</span> <span class="cn">NA</span>, <span class="at">no =</span> cars<span class="sc">$</span>speed <span class="sc">*</span> <span class="fl">1.60934</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cars, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    speed dist  dist_m speed_km
## 1      4    2  0.6096       NA
## 2      4   10  3.0480       NA
## 3      7    4  1.2192       NA
## 4      7   22  6.7056       NA
## 5      8   16  4.8768       NA
## 6      9   10  3.0480       NA
## 7     10   18  5.4864 16.09340
## 8     10   26  7.9248 16.09340
## 9     10   34 10.3632 16.09340
## 10    11   17  5.1816 17.70274</code></pre>
<p>Dans cet exemple, la valeur fournie au deuxième argument (<code>yes</code>) n’est pas un vecteur de même longueur que les valeurs fournies aux arguments <code>test</code> et <code>no</code>. R applique donc la règle de recyclage pour transformer <code>NA</code>, qui est en fait un vecteur de longueur 1, en un vecteur contenant <code>length(cars$speed)=</code> 50 valeurs <code>NA</code>.</p>
<p>Il est même possible d’imbriquer plusieurs appels à la fonction <code>ifelse</code>, comme dans cet exemple.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>speed_cat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> cars<span class="sc">$</span>speed <span class="sc">&lt;</span> <span class="dv">10</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">yes =</span> <span class="st">&quot;moins de 10&quot;</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">no =</span> <span class="fu">ifelse</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> cars<span class="sc">$</span>speed <span class="sc">&gt;=</span> <span class="dv">20</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">yes =</span> <span class="st">&quot;20 ou plus&quot;</span>, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">no =</span> <span class="st">&quot;entre 10 et 20&quot;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  5 variables:
##  $ speed    : num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist     : num  2 10 4 22 16 10 18 26 34 17 ...
##  $ dist_m   : num  0.61 3.05 1.22 6.71 4.88 ...
##  $ speed_km : num  NA NA NA NA NA ...
##  $ speed_cat: chr  &quot;moins de 10&quot; &quot;moins de 10&quot; &quot;moins de 10&quot; &quot;moins de 10&quot; ...</code></pre>
<p>Voici un extrait du jeu de données pour mieux comprendre de quoi a l’air la nouvelle variable créée.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cars[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">38</span><span class="sc">:</span><span class="dv">40</span>), <span class="fu">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;speed_cat&quot;</span>)]</span></code></pre></div>
<pre><code>##    speed      speed_cat
## 5      8    moins de 10
## 6      9    moins de 10
## 7     10 entre 10 et 20
## 38    19 entre 10 et 20
## 39    20     20 ou plus
## 40    20     20 ou plus</code></pre>
<p>Nous avons catégorisé la variable <code>speed</code> en 3 catégories. Il existe cependant de meilleures façons de faire ce genre de tâche, présentées dans la sous-section suivante.</p>
<p>Notons, avant de clore cette sous-section, que le package <code>dplyr</code> offre une fonction de remplacement à <code>ifelse</code>, nommée <a href="https://dplyr.tidyverse.org/reference/if_else.html"><code>if_else</code></a>, tout comme le package <code>data.table</code> avec la fonction <a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html"><code>fifelse</code></a>. Ces fonctions ont le potentiel d’être plus rapides que <code>ifelse</code>.</p>
</div>
<div id="catégorisation-dune-variable-numérique" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Catégorisation d’une variable numérique</h2>
<p>Parfois, nous avons besoin de rendre catégorique une variable numérique. Les agences de statistiques officielles, par exemple Statistique Canada, font souvent de telles catégorisations avant de rendre des données publiques afin qu’il ne soit plus possible d’identifier les individus auxquels réfèrent les données. Il s’agit d’une technique courante d’anonymisation de données qui contribue à permettre l’accès à des données tout en respectant des règlements concernant la confidentialité des données.</p>
<div id="fonction-cut" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Fonction <code>cut</code> :</h3>
<p>La principale fonction pour catégoriser une variable numérique en R est la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/cut.html">fonction <code>cut</code></a>. En voici un exemple d’utilisation.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>speed_cat_2 <span class="ot">&lt;-</span> <span class="fu">cut</span>(cars<span class="sc">$</span>speed, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="cn">Inf</span>), <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  6 variables:
##  $ speed      : num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist       : num  2 10 4 22 16 10 18 26 34 17 ...
##  $ dist_m     : num  0.61 3.05 1.22 6.71 4.88 ...
##  $ speed_km   : num  NA NA NA NA NA ...
##  $ speed_cat  : chr  &quot;moins de 10&quot; &quot;moins de 10&quot; &quot;moins de 10&quot; &quot;moins de 10&quot; ...
##  $ speed_cat_2: Factor w/ 3 levels &quot;[-Inf,10)&quot;,&quot;[10,20)&quot;,..: 1 1 1 1 1 1 2 2 2 2 ...</code></pre>
<p>L’argument <code>right</code> sert à préciser si les limites de droite des intervalles de catégorisation sont incluses dans ceux-ci ou non. Ici, la valeur <code>FALSE</code> fournie à cet argument a pour conséquence que les intervalles sont ouverts à droite : <span class="math inline">\([-\infty, 10), [10, 20), [20, \infty)\)</span>.</p>
<p>La nouvelle variable obtenue est un facteur, avec des libellés de niveaux différents de ceux de la variable <code>speed_cat</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cars[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">38</span><span class="sc">:</span><span class="dv">40</span>), <span class="fu">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;speed_cat&quot;</span>, <span class="st">&quot;speed_cat_2&quot;</span>)]</span></code></pre></div>
<pre><code>##    speed      speed_cat speed_cat_2
## 5      8    moins de 10   [-Inf,10)
## 6      9    moins de 10   [-Inf,10)
## 7     10 entre 10 et 20     [10,20)
## 38    19 entre 10 et 20     [10,20)
## 39    20     20 ou plus   [20, Inf)
## 40    20     20 ou plus   [20, Inf)</code></pre>
<p>Nous pouvons contrôler ces libellés avec l’argument <code>labels</code> de la fonction <code>cut</code>, comme dans cet exemple.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>speed_cat_3 <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  cars<span class="sc">$</span>speed, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="cn">Inf</span>), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;faible&quot;</span>, <span class="st">&quot;moyenne&quot;</span>, <span class="st">&quot;grande&quot;</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">FALSE</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>cars[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">38</span><span class="sc">:</span><span class="dv">40</span>), <span class="fu">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;speed_cat&quot;</span>, <span class="st">&quot;speed_cat_2&quot;</span>, <span class="st">&quot;speed_cat_3&quot;</span>)]</span></code></pre></div>
<pre><code>##    speed      speed_cat speed_cat_2 speed_cat_3
## 5      8    moins de 10   [-Inf,10)      faible
## 6      9    moins de 10   [-Inf,10)      faible
## 7     10 entre 10 et 20     [10,20)     moyenne
## 38    19 entre 10 et 20     [10,20)     moyenne
## 39    20     20 ou plus   [20, Inf)      grande
## 40    20     20 ou plus   [20, Inf)      grande</code></pre>
</div>
<div id="fonction-case_when-du-package-dplyr" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Fonction <code>case_when</code> du package <code>dplyr</code></h3>
<p>L’équivalent de la fonction <code>cut</code> dans l’univers du <code>tidyverse</code> est la <a href="https://dplyr.tidyverse.org/reference/case_when.html">fonction <code>case_when</code> du package <code>dplyr</code></a>. À titre d’exemple, le dernier appel à <code>cut</code> est reproduit comme suit avec <code>case_when</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>speed_cat_4 <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  cars<span class="sc">$</span>speed <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">&quot;faible&quot;</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  cars<span class="sc">$</span>speed <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> cars<span class="sc">$</span>speed <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;moyenne&quot;</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  cars<span class="sc">$</span>speed <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;grande&quot;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  8 variables:
##  $ speed      : num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist       : num  2 10 4 22 16 10 18 26 34 17 ...
##  $ dist_m     : num  0.61 3.05 1.22 6.71 4.88 ...
##  $ speed_km   : num  NA NA NA NA NA ...
##  $ speed_cat  : chr  &quot;moins de 10&quot; &quot;moins de 10&quot; &quot;moins de 10&quot; &quot;moins de 10&quot; ...
##  $ speed_cat_2: Factor w/ 3 levels &quot;[-Inf,10)&quot;,&quot;[10,20)&quot;,..: 1 1 1 1 1 1 2 2 2 2 ...
##  $ speed_cat_3: Factor w/ 3 levels &quot;faible&quot;,&quot;moyenne&quot;,..: 1 1 1 1 1 1 2 2 2 2 ...
##  $ speed_cat_4: chr  &quot;faible&quot; &quot;faible&quot; &quot;faible&quot; &quot;faible&quot; ...</code></pre>
<p>Contrairement à la fonction <code>cut</code>, <code>case_when</code> retourne un vecteur plutôt qu’un facteur.</p>
</div>
<div id="fonction-ave" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Fonction <code>ave</code> :</h3>
<p>Si nous souhaitions remplacer les identifiants des nouvelles catégories par une statistique calculée sur les valeurs observées dans chaque catégorie, nous utiliserions la <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/ave.html">fonction <code>ave</code></a>, comme dans cet exemple.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cars<span class="sc">$</span>speed_ave <span class="ot">&lt;-</span> <span class="fu">ave</span>(cars<span class="sc">$</span>speed, cars<span class="sc">$</span>speed_cat, <span class="at">FUN =</span> mean)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cars[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">38</span><span class="sc">:</span><span class="dv">40</span>),<span class="fu">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;speed_cat&quot;</span>, <span class="st">&quot;speed_cat_2&quot;</span>, <span class="st">&quot;speed_ave&quot;</span>)]</span></code></pre></div>
<pre><code>##    speed      speed_cat speed_cat_2 speed_ave
## 5      8    moins de 10   [-Inf,10)   6.50000
## 6      9    moins de 10   [-Inf,10)   6.50000
## 7     10 entre 10 et 20     [10,20)  14.53125
## 38    19 entre 10 et 20     [10,20)  14.53125
## 39    20     20 ou plus   [20, Inf)  22.16667
## 40    20     20 ou plus   [20, Inf)  22.16667</code></pre>
<p>Pour une observation, la valeur de la nouvelle variable <code>speed_ave</code> est la moyenne de toutes les vitesses observées dans la même catégorie que celle de l’observation en question.</p>
<div id="comparaison-entre-la-fonction-ave-et-les-fonctions-tapply-by-et-aggregate" class="section level4" number="1.3.3.1">
<h4><span class="header-section-number">1.3.3.1</span> Comparaison entre la fonction <code>ave</code> et les fonctions <code>tapply</code>, <code>by</code> et <code>aggregate</code> :</h4>
<p></p>
<p>La fonction <code>ave</code> calcule une statistique selon des combinaisons de niveaux de facteurs, tout comme les fonctions <code>tapply</code>, <code>by</code> et <code>aggregate</code>. Cependant, elle retourne un objet de même dimension que le premier argument qu’elle reçoit en entrée plutôt que de retourner une valeur par combinaison distincte de niveaux de facteurs. Par exemple, voici l’appel à la fonction <code>aggregate</code> correspondant à l’appel à la fonction <code>ave</code> précédent.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="at">x =</span> cars<span class="sc">$</span>speed, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">catego =</span> cars<span class="sc">$</span>speed_cat), <span class="at">FUN =</span> mean)</span></code></pre></div>
<pre><code>##           catego        x
## 1     20 ou plus 22.16667
## 2 entre 10 et 20 14.53125
## 3    moins de 10  6.50000</code></pre>
<p>Ici, le résultat produit possède seulement 3 lignes, pour les trois catégories distinctes. La sortie de l’appel à la fonction <code>ave</code> précédent était plutôt de longueur 50, soit la longueur de <code>cars$speed</code>.</p>
</div>
</div>
</div>
<div id="normalisation-de-valeurs-numériques" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Normalisation de valeurs numériques</h2>
<p>La normalisation permet de ramener les mesures de différentes variables sur une même échelle.</p>
<div id="fonction-scale" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Fonction <code>scale</code></h3>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/scale.html">fonction <code>scale</code></a> permet de normaliser par colonne les valeurs numériques dans une matrice ou un data frame.</p>
<p>Par exemple, revenons au jeu de données <code>cars</code> d’origine.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> datasets<span class="sc">::</span>cars</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cars)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    50 obs. of  2 variables:
##  $ speed: num  4 4 7 7 8 9 10 10 10 11 ...
##  $ dist : num  2 10 4 22 16 10 18 26 34 17 ...</code></pre>
<p>Les valeurs pour les deux variables dans le jeu de données <code>cars</code> ne sont pas sur la même échelle. En effet, leurs moyennes et écarts-types empiriques ne sont pas similaires. Utilisons la fonction <code>apply</code>, vue dans les notes sur les <a href="https://stt4230.rbind.io/calculs/calculs_apply_r/#fonction-apply">calculs par sections d’un objet R</a>, pour calculer ces statistiques par variable (= par colonne).</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># moyennes par variable</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(cars, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span></code></pre></div>
<pre><code>## speed  dist 
## 15.40 42.98</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># écarts-types par variable</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(cars, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> sd)</span></code></pre></div>
<pre><code>##     speed      dist 
##  5.287644 25.769377</code></pre>
<p>Une normalisation couramment employée consiste à soustraire de valeurs leur moyenne, puis à diviser ces différences par l’écart-type des valeurs d’origine. Cette normalisation est parfois appelée standardisation. Les valeurs sont centrées et réduites. En notation statistique, la formule pour obtenir cette normalisation est la suivante :</p>
<p><span class="math inline">\(z_i = \frac{x_i - \bar{x}}{\sigma_x}\)</span></p>
<p>où <span class="math inline">\(\bar{x}\)</span> est la moyenne des observations <span class="math inline">\(x_i\)</span> et <span class="math inline">\(\sigma_x\)</span> leur écart-type. Standardisons les valeurs du jeu de donnes <code>cars</code> avec la fonction <code>scale</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cars_standard <span class="ot">&lt;-</span> <span class="fu">scale</span>(cars)</span></code></pre></div>
<p>Les valeurs dans chacune des colonnes de <code>cars_standard</code> ont une moyenne de 0 et un écart-type de 1. Elles sont donc sur la même échelle.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># moyennes par variable</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">apply</span>(cars_standard, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean), <span class="at">digits =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## speed  dist 
##     0     0</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># écarts-types par variable</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(cars_standard, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> sd)</span></code></pre></div>
<pre><code>## speed  dist 
##     1     1</code></pre>
<p>Les arguments <code>center</code> et <code>scale</code> de la fonction <code>scale</code> permettent de contrôler, respectivement, les valeurs soustraites par colonnes et les valeurs par lesquelles les colonnes sont divisées. Il est possible, par exemple, de centrer sans réduire avec <code>center = TRUE</code> et <code>scale = FALSE</code>.</p>
<p>Un autre exemple de normalisation possible avec <code>scale</code> est de ramener les mesures de toutes les variables entre 0 et 1. En notation statistique, la formule pour obtenir cette normalisation est la suivante :</p>
<p><span class="math inline">\(y_i = \frac{x_i - \min(x)}{\max(x) - \min(x)}.\)</span></p>
<p>Effectuons cette normalisation sur le jeu de données <code>cars</code>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>minimums <span class="ot">&lt;-</span> <span class="fu">apply</span>(cars, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> min)  <span class="co"># obtention des minimums par variable</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>maximums <span class="ot">&lt;-</span> <span class="fu">apply</span>(cars, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> max)  <span class="co"># obtention des maximums par variable</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>cars_01norm <span class="ot">&lt;-</span> <span class="fu">scale</span>(cars, <span class="at">center =</span> minimums, <span class="at">scale =</span> maximums <span class="sc">-</span> minimums)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cars_01norm)</span></code></pre></div>
<pre><code>##      speed             dist       
##  Min.   :0.0000   Min.   :0.0000  
##  1st Qu.:0.3810   1st Qu.:0.2034  
##  Median :0.5238   Median :0.2881  
##  Mean   :0.5429   Mean   :0.3473  
##  3rd Qu.:0.7143   3rd Qu.:0.4576  
##  Max.   :1.0000   Max.   :1.0000</code></pre>
<p><strong>Note</strong> : La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/sweep.html">fonction <code>sweep</code></a> permet aussi de faire simultanément une transformation pour chacune des colonnes d’une matrice. Elle généralise en fait <code>scale</code> en permettant d’effectuer la transformation sur n’importe laquelle des dimensions d’un array. Cette fonction ne sera cependant pas approfondie ici.</p>
</div>
</div>
<div id="manipulation-de-chaînes-de-caractères" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Manipulation de chaînes de caractères</h2>
<p>D’un langage de programmation à l’autre, les chaînes de caractères ne sont pas manipulées de la même façon. Par exemple, si un objet R contient une chaîne de caractères telle la suivante,</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>chaine <span class="ot">&lt;-</span> <span class="st">&quot;Bonjour&quot;</span></span></code></pre></div>
<p>il n’est pas possible d’extraire disons la deuxième lettre de la chaîne avec la commande suivante.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>chaine[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Cette commande aurait fonctionné en langage Python. Elle ne fonctionne pas en R, parce que l’objet <code>chaine</code> est un vecteur de longueur 1. L’opérateur d’indiçage <code>[</code> réfère à des éléments d’un objet. L’objet <code>chaine</code> ne contient qu’un seul élément, qui est une chaîne de caractères.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(chaine)</span></code></pre></div>
<pre><code>##  chr &quot;Bonjour&quot;</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(chaine)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>chaine[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Bonjour&quot;</code></pre>
<p>Cette section présente quelques fonctions R de base pour manipuler des vecteurs dont les éléments sont des chaînes de caractères. Toutes ces fonctions travaillent de façon vectorielle. Elles effectuent d’un coup une opération sur tous les éléments d’un vecteur.</p>
<p>Ces fonctions seront illustrées en utilisant un data frame nommé <code>boxoffice</code> créé le 25 janvier 2019 en important le contenu de la page web <a href="http://pro.boxoffice.com/numbers/all_time" class="uri">http://pro.boxoffice.com/numbers/all_time</a>. Cette page web n’existe plus aujourd’hui, car le site web Boxoffice Pro a subi une refonte. Utilisons tout de même ces données, même si elles ne sont plus à jour, puisque leur format est parfait pour illustrer la manipulation de chaînes de caractères et de dates en R.</p>
<p>Une copie des données se trouve dans le haut de <a href="https://stt4230.rbind.io/manipulation_donnees/pretraitement_donnees_r/">la page web des notes que vous êtes en train de lire</a>. Le fichier contenant les données est en format <code>.rds</code>, il se nomme <code>boxoffice_20190125.rds</code>. Il se trouve dans le fichier compressé <code>pretraitement_donnees_r_2021.zip</code>. Après avoir téléchargé ce fichier sur votre ordinateur, et après l’avoir décompressé pour en extraire <code>boxoffice_20190125.rds</code>, vous pouvez charger les données en R avec le code suivant (en spécifiant le bon chemin d’accès) :</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>boxoffice <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;C:/coursR/boxoffice_20190125.rds&quot;</span>)</span></code></pre></div>
<p>Le data frame <code>boxoffice</code> utilisé ici ressemble à celui créé dans les <a href="https://stt4230.rbind.io/manipulation_donnees/lecture_ecriture_r/#donn%C3%A9es-publi%C3%A9es-sur-internet">notes sur la lecture et l’écriture dans des fichiers externes à partir de R</a>, mais il contient des données moins récentes et présentées sous un format un peu différent.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(boxoffice, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   X1                                    X2           X3           X4
## 1  1 Star Wars: The Force Awakens (Disney) Dec 18, 2015 $936,662,225
## 2  2                          Avatar (Fox) Dec 18, 2009 $760,507,625
## 3  3                Black Panther (Disney) Feb 16, 2018 $700,059,566</code></pre>
<p>Les noms des colonnes du data frame ne sont pas informatifs. Renommons les colonnes du data frame en reprenant les noms de colonnes qui apparaissaient dans la page web d’où ses données proviennent (en remplaçant les espaces par des tirets bas et en omettant les parenthèses).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(boxoffice) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ranking&quot;</span>, <span class="st">&quot;Movie_Distributor&quot;</span>, <span class="st">&quot;Release_Date&quot;</span>, <span class="st">&quot;Gross&quot;</span>)</span></code></pre></div>
<p>Il s’agit de données concernant les recettes (<code>Gross</code>) des films ayant généré le plus de revenus dans les cinémas américains.</p>
<div id="fonction-paste" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Fonction <code>paste</code> :</h3>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/paste.html">fonction <code>paste</code></a> sert à concaténer des éléments de vecteurs. Elle retourne toujours un résultat sous le format caractère. Elle n’est pas illustrée ici, car elle a été présentée dans les <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#fonctions-paste-et-paste0">notes sur les structures de données en R</a>.</p>
<p>Rappelons que la fonction <code>paste0</code> est en quelque sorte une version de la fonction <code>paste</code> avec l’argument <code>sep = ""</code> (aucun caractère comme séparation entre les chaînes de caractères à concaténer).</p>
</div>
<div id="fonction-nchar" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Fonction <code>nchar</code> :</h3>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/nchar.html">fonction <code>nchar</code></a> permet de compter le nombre de caractères dans des chaînes de caractères. Elle a aussi été illustrée dans les <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#vecteurs-de-cha%C3%AEnes-de-caract%C3%A8res">notes sur les structures de données en R</a>.</p>
</div>
<div id="fonctions-toupper-tolower-et-casefold" class="section level3" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Fonctions <code>toupper</code>, <code>tolower</code> et <code>casefold</code> :</h3>
<p>Les <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/chartr.html">fonctions <code>toupper</code> et <code>tolower</code></a> transforment tous les caractères alphabétiques en majuscules et en minuscules respectivement.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>extrait <span class="ot">&lt;-</span> <span class="fu">head</span>(boxoffice<span class="sc">$</span>Movie_Distributor, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>extrait</span></code></pre></div>
<pre><code>## [1] &quot;Star Wars: The Force Awakens (Disney)&quot; &quot;Avatar (Fox)&quot;</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toupper</span>(extrait)</span></code></pre></div>
<pre><code>## [1] &quot;STAR WARS: THE FORCE AWAKENS (DISNEY)&quot; &quot;AVATAR (FOX)&quot;</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(extrait)</span></code></pre></div>
<pre><code>## [1] &quot;star wars: the force awakens (disney)&quot; &quot;avatar (fox)&quot;</code></pre>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/chartr.html">fonction <code>casefold</code></a>, utilisée comme exemple de fonction dans les <a href="https://stt4230.rbind.io/introduction/base_r/#fonctions-r">notes sur les concepts de base en R</a>, permet de faire les deux transformations de casse, soit transformer tous les caractères alphabétiques en majuscules (avec l’argument <code>upper = TRUE</code>) ou transformer tous les caractères alphabétiques en minuscules (avec l’argument <code>upper = FALSE</code>).</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">casefold</span>(extrait, <span class="at">upper =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;STAR WARS: THE FORCE AWAKENS (DISNEY)&quot; &quot;AVATAR (FOX)&quot;</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">casefold</span>(extrait, <span class="at">upper =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;star wars: the force awakens (disney)&quot; &quot;avatar (fox)&quot;</code></pre>
</div>
<div id="fonction-strsplit" class="section level3" number="1.5.4">
<h3><span class="header-section-number">1.5.4</span> Fonction <code>strsplit</code> :</h3>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/strsplit.html">fonction <code>strsplit</code></a> sépare des chaînes de caractères en sous-chaînes de caractères en coupant lors de la rencontre d’une certaine série de caractères. Tentons d’utiliser cette fonction pour séparer le nom du film du nom du distributeur, qui se retrouvent tous deux dans la colonne <code>Movie_Distributor</code> du data frame <code>boxoffice</code>. Demandons à <code>strsplit</code> de briser le contenu de cette colonne en deux parties : ce qui se trouve avant la parenthèse ouvrante et ce qui se trouve après. Étant donné que le nom du distributeur est toujours placé à la fin de la chaîne de caractères, entre parenthèses, nous réussirons ainsi à isoler les deux éléments.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>res_split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(<span class="at">x =</span> boxoffice<span class="sc">$</span>Movie_Distributor, <span class="at">split =</span> <span class="st">&quot;(&quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_split, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Star Wars: The Force Awakens &quot; &quot;Disney)&quot;                      
## 
## [[2]]
## [1] &quot;Avatar &quot; &quot;Fox)&quot;</code></pre>
<p>Par défaut, la fonction considère que la valeur donnée a l’argument <code>split</code> est une <a href="https://fr.wikipedia.org/wiki/Expression_r%C3%A9guli%C3%A8re">expression régulière</a>. Les expressions régulières ne seront pas vues ici (mais des références pour en apprendre davantage à ce sujet sont fournies dans les références). Elles constituent un moyen puissant pour effectuer des recherches dans des chaînes de caractères. L’argument <code>fixed = TRUE</code> demande à <code>strsplit</code> de ne pas considérer l’argument <code>split</code> comme une expression régulière, mais bien de traiter la chaîne de caractères telle qu’elle a été fournie.</p>
<p>Le résultat de la fonction <code>strsplit</code> est toujours une liste de la même longueur que le vecteur assigné à l’argument <code>x</code>. Chaque élément de la liste est un vecteur comprenant les sous-chaînes de caractères obtenues de la séparation. Ici, ces vecteurs ont le plus souvent une longueur de 2. Par exemple pour le premier film du jeu de données, Star Wars: The Force Awakens (Disney), on obtient le vecteur <code>["Star Wars: The Force Awakens ", "Disney)"]</code>. Par contre, certains titres de film comprennent un élément entre parenthèses de plus, par exemple <code>"The Lion King (1994) (Disney)"</code>. Pour eux, la longueur du vecteur est 3.</p>
<p>La commande suivante permet d’extraire le dernier élément de chacun des vecteurs se trouvant dans <code>res_split</code>. Elle utilise la fonction <code>sapply</code> vue dans le cours sur les <a href="https://stt4230.rbind.io/calculs/calculs_apply_r/#fonctions-lapply-sapply-et-mapply">calculs par sections d’un objet R</a>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>distributeur <span class="ot">&lt;-</span> <span class="fu">sapply</span>(res_split, tail, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distributeur, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Disney)&quot; &quot;Fox)&quot;</code></pre>
</div>
<div id="fonction-substr" class="section level3" number="1.5.5">
<h3><span class="header-section-number">1.5.5</span> Fonction <code>substr</code> :</h3>
<p>Afin d’avoir vraiment isolé le nom du distributeur, il ne reste plus qu’à retirer la parenthèse fermante à la fin des chaînes de caractères dans <code>distributeur</code>. La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/substr.html">fonction <code>substr</code></a> permet d’extraire une partie de chaînes de caractères en spécifiant les positions, dans les chaînes, des caractères à conserver.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>distributeur <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="at">x =</span> distributeur, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">stop =</span> <span class="fu">nchar</span>(distributeur) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distributeur, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Disney&quot; &quot;Fox&quot;</code></pre>
<p>Ici nous voulons extraire les caractères de la première position jusqu’à l’avant-dernière position. Celle-ci varie d’une observation à l’autre, c’est pourquoi nous utilisons l’expression <code>nchar(distributeur) - 1</code> pour la calculer.</p>
<p>Notons que nous aurions aussi pu effectuer ce traitement avec la fonction <code>strsplit</code>, en utilisant <code>)</code> comme point de coupure, ou encore avec la fonction <code>sub</code>, comme dans l’exemple suivant.</p>
</div>
<div id="fonctions-sub-et-gsub" class="section level3" number="1.5.6">
<h3><span class="header-section-number">1.5.6</span> Fonctions <code>sub</code> et <code>gsub</code> :</h3>
<p>Voyons maintenant comment il est possible de remplacer une sous-chaîne de caractères par une autre. Dans les données <code>boxoffice</code>, les recettes des films comprennent un signe de dollar au début, ainsi que des virgules pour séparer les milliers. À cause de ces caractères, cette colonne ne peut pas être transformée sous un format numérique directement. Nous allons donc retirer ces caractères en les remplaçant par des chaînes de caractères vides. Ensuite, nous pourrons convertir le vecteur au format numérique plutôt que caractère.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>recettes <span class="ot">&lt;-</span> boxoffice<span class="sc">$</span>Gross</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(recettes)</span></code></pre></div>
<pre><code>##  chr [1:1000] &quot;$936,662,225&quot; &quot;$760,507,625&quot; &quot;$700,059,566&quot; &quot;$678,815,482&quot; ...</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>recettes <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="at">pattern =</span> <span class="st">&quot;$&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> recettes, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(recettes)</span></code></pre></div>
<pre><code>##  chr [1:1000] &quot;936,662,225&quot; &quot;760,507,625&quot; &quot;700,059,566&quot; &quot;678,815,482&quot; ...</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>recettes <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;,&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> recettes, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(recettes)</span></code></pre></div>
<pre><code>##  chr [1:1000] &quot;936662225&quot; &quot;760507625&quot; &quot;700059566&quot; &quot;678815482&quot; &quot;658672302&quot; ...</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>recettes <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(recettes)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(recettes)</span></code></pre></div>
<pre><code>##  num [1:1000] 9.37e+08 7.61e+08 7.00e+08 6.79e+08 6.59e+08 ...</code></pre>
<p>Il est maintenant possible de faire des calculs numériques sur les recettes des films, puisqu’elles sont stockées sous un format numérique.</p>
<p>Les <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/grep.html">fonctions <code>sub</code> et <code>gsub</code></a> servent donc à chercher les occurrences d’un « motif » (argument <code>pattern</code>) dans des chaînes de caractères (argument <code>x</code>), puis à remplacer ces occurrences par un autre motif (argument <code>replacement</code>). La fonction <code>sub</code> remplace seulement la première occurrence de <code>pattern</code>, alors que la fonction <code>gsub</code> remplace toutes les occurrences. Tout comme la fonction <code>strsplit</code>, les fonctions <code>sub</code> et <code>gsub</code> travaillent par défaut avec des motifs exprimés sous forme d’expressions régulières. L’argument <code>fixed = TRUE</code> empêche ce comportement et implique le traitement des motifs comme des chaînes de caractères.</p>
</div>
<div id="fonctions-grep-et-grepl" class="section level3" number="1.5.7">
<h3><span class="header-section-number">1.5.7</span> Fonctions <code>grep</code> et <code>grepl</code> :</h3>
<p>Supposons que nous désirions avoir une variable logique prenant la valeur <code>TRUE</code> si la compagnie Disney a distribué le film, <code>FALSE</code> sinon. Nous pourrions utiliser la fonction <code>grepl</code> comme suit pour obtenir cette variable.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Disney <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">&quot;Disney&quot;</span>, <span class="at">x =</span> distributeur, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(Disney)</span></code></pre></div>
<pre><code>## [1] 161</code></pre>
<p>Ainsi, 161 des 1000 films du jeu de données <code>boxoffice</code> ont été distribués par Disney.</p>
<p>Les <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/grep.html">fonctions <code>grep</code> et <code>grepl</code></a> identifient les éléments d’un vecteur de chaînes de caractères (argument <code>x</code>) contenant un certain « motif » (argument <code>pattern</code>). Pour ne pas que ce motif soit traité comme une expression régulière, il faut fournir la valeur <code>TRUE</code> à l’argument <code>fixed</code>. La fonction <code>grep</code> retourne un vecteur numérique contenant les positions dans <code>x</code> des éléments possédant le motif. Comme nous l’avons constaté dans l’exemple précédent, la fonction <code>grepl</code> retourne pour sa part un vecteur logique aussi long que <code>x</code>, contenant la valeur <code>TRUE</code> pour les éléments possédant le motif, <code>FALSE</code> sinon.</p>
<p>Les fonctions <code>sub</code>, <code>gsub</code>, <code>grep</code> et <code>grepl</code> sont toutes documentées dans la même fiche d’aide : <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/grep.html">celle de la fonction <code>grep</code></a>. Quelques autres fonctions de manipulation de chaînes de caractères sont documentées dans cette fiche, mais ne sont pas présentées ici.</p>
</div>
<div id="fonction-chartr" class="section level3" number="1.5.8">
<h3><span class="header-section-number">1.5.8</span> Fonction <code>chartr</code> :</h3>
<p>Lorsque nous avons besoin de remplacer une série de caractères par d’autres (chaque caractère de la série ayant une valeur de remplacement spécifique), il est possible de procéder en appelant la fonction <code>gsub</code> séparément pour chaque caractère de la série. Il existe cependant une façon de faire plus rapide : utiliser la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/chartr.html">fonction <code>chartr</code></a>. Il faut fournir à cette fonction une chaîne de caractères comprenant tous les caractères à traduire (argument <code>old</code>). Il faut aussi lui fournir une chaîne de caractères comprenant tous les caractères de remplacement (argument <code>new</code>), en respectant l’ordre des caractères dans le premier vecteur. Finalement, il faut fournir à <code>chartr</code> le vecteur des chaînes de caractères dans lesquelles effectuer les remplacements.</p>
<p>Par exemple, la commande suivante permet de retirer les accents français d’un vecteur de chaînes de caractères.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="st">&quot;ÀÂÇÈÉÊËÎÏÔÙÛÜàâçèéêëîïôùûü&quot;</span>,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="st">&quot;AACEEEEIIOUUUaaceeeeiiouuu&quot;</span>,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;François va à l&#39;École des Pionniers.&quot;</span>, <span class="st">&quot;Où est située cette école?&quot;</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;Francois va a l&#39;Ecole des Pionniers.&quot; &quot;Ou est situee cette ecole?&quot;</code></pre>
</div>
<div id="fonction-iconv" class="section level3" number="1.5.9">
<h3><span class="header-section-number">1.5.9</span> Fonction <code>iconv</code> :</h3>
<p>Pour la tâche spécifique de retirer des accents, il est en fait encore plus simple d’utiliser la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/iconv.html">fonction <code>iconv</code></a>. Celle-ci permet de convertir l’encodage de chaîne de caractères. Un bon truc pour retirer des accents de chaînes de caractères, peu importe la langue utilisée dans ces chaînes, est de convertir vers l’encodage <code>"ASCII//TRANSLIT"</code>. Voici un exemple.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iconv</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;François va à l&#39;École des Pionniers.&quot;</span>, <span class="st">&quot;Où est située cette école?&quot;</span>), </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="st">&quot;ASCII//TRANSLIT&quot;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;Francois va a l&#39;Ecole des Pionniers.&quot; &quot;Ou est situee cette ecole?&quot;</code></pre>
<p>La sortie de cette commande peut varier d’un système d’exploitation à l’autre à l’autre.</p>
</div>
<div id="package-stringr" class="section level3" number="1.5.10">
<h3><span class="header-section-number">1.5.10</span> Package <code>stringr</code></h3>
<p>Un package du <code>tidyverse</code> se spécialise en manipulation de chaînes de caractères. Il s’agit du package <a href="https://stringr.tidyverse.org/"><code>stringr</code></a>, qui propose des solutions de rechange à à peu près tout ce qui a été présenté dans cette sous-section. Les noms des fonctions de ce package, et de leurs arguments, ont été choisis de façon à être cohérents entre eux, ce qui n’est pas vraiment le cas pour les fonctions de manipulation de chaînes de caractères dans le R de base. En outre, quelques fonctions du package <code>stringr</code> simplifient la réalisation de tâches courantes en manipulation de chaînes de caractères. Par exemple, la fonction <code>str_trim</code> permet de retirer tout espace blanc en début et fin de chaînes de caractères. Les espaces blancs (en anglais <a href="https://en.wikipedia.org/wiki/Whitespace_character"><em>whitespace</em></a>) les plus courants sont les espaces, les tabulations (<code>\t</code>), et les retours à la ligne (<code>\n</code>).</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> <span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\t</span><span class="st">François va à l&#39;École des Pionniers. &quot;</span>, <span class="st">&quot;Où est située cette école?</span><span class="sc">\n</span><span class="st">&quot;</span>),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">side =</span> <span class="st">&quot;both&quot;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;François va à l&#39;École des Pionniers.&quot;
## [2] &quot;Où est située cette école?&quot;</code></pre>
<p>Des références sont fournies à la fin de ce document pour en apprendre davantage sur le package <code>stringr</code>.</p>
</div>
</div>
<div id="manipulation-de-dates" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Manipulation de dates</h2>
<p>Une des variables de <code>boxoffice</code> est une date : la variable <code>Release_Date</code> contenant la date de sortie des films. Elle est pour l’instant stockée sous format caractère.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(boxoffice<span class="sc">$</span>Release_Date)</span></code></pre></div>
<pre><code>##  chr [1:1000] &quot;Dec 18, 2015&quot; &quot;Dec 18, 2009&quot; &quot;Feb 16, 2018&quot; &quot;Apr 27, 2018&quot; ...</code></pre>
<p>Nous pourrions vouloir compter le nombre d’années écoulées depuis la sortie des films. Pour ce faire, le plus simple est d’utiliser une classe dédiée à la manipulation de dates proposée par R.</p>
<div id="fonctions-as.date-et-sys.getlocale" class="section level3" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> Fonctions <code>as.Date</code> et <code>Sys.getlocale</code></h3>
<p>Nous allons convertir les données dans la colonne <code>Release_Date</code> vers la classe <code>"Date"</code> de R avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.Date.html">fonction <code>as.Date</code></a>. Cependant, cette conversion fonctionnera uniquement si les paramètres régionaux (en anglais <em>locale</em>) de notre session R sont en anglais, puisque les dates comportent des abréviations de noms de mois en anglais. Ainsi, commençons par vérifier quel paramètre régional pour le temps utilise notre session R avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/locales.html">fonction <code>Sys.getlocale</code></a>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getlocale</span>(<span class="at">category =</span> <span class="st">&quot;LC_TIME&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;English_Canada.1252&quot;</code></pre>
<p>Dans mon cas, j’utilise un système d’exploitation en anglais. En conséquence, les paramètres régionaux de mes sessions R sont par défaut en anglais. Si ce n’est pas votre cas, il faut d’abord changer le paramètre <code>"LC_TIME"</code> de votre session R pour qu’il s’agisse de l’anglais. Sous Windows, vous pouvez procéder comme suit.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous Windows</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_TIME&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;English&quot;</span>)</span></code></pre></div>
<p>Les valeurs comprises comme argument <code>locale</code> dépendent du système d’exploitation. Sous un système d’exploitation macOS ou Linux, tentez une des valeurs suivantes : <code>"en_CA"</code>, <code>"en_CA.UTF-8"</code> ou <code>"en_CA.utf8"</code> (ou la version US de ces valeurs, soit <code>"en_US"</code>, <code>"en_US.UTF-8"</code> ou <code>"en_US.utf8"</code>).</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous macOS</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_TIME&quot;</span>, <span class="at">locale =</span> <span class="st">&quot;en_CA.UTF-8&quot;</span>)</span></code></pre></div>
<p>Une fois s’être assuré d’avoir un paramètre <code>"LC_TIME"</code> en anglais, nous pouvons appeler la fonction <code>as.Date</code> comme suit.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>boxoffice<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(boxoffice<span class="sc">$</span>Release_Date, <span class="at">format =</span> <span class="st">&quot;%b %d, %Y&quot;</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(boxoffice[, <span class="fu">c</span>(<span class="st">&quot;Release_Date&quot;</span>, <span class="st">&quot;Date&quot;</span>)])</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  2 variables:
##  $ Release_Date: chr  &quot;Dec 18, 2015&quot; &quot;Dec 18, 2009&quot; &quot;Feb 16, 2018&quot; &quot;Apr 27, 2018&quot; ...
##  $ Date        : Date, format: &quot;2015-12-18&quot; &quot;2009-12-18&quot; ...</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">subset</span>(boxoffice, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Ranking, Gross)))</span></code></pre></div>
<pre><code>##                       Movie_Distributor Release_Date       Date
## 1 Star Wars: The Force Awakens (Disney) Dec 18, 2015 2015-12-18
## 2                          Avatar (Fox) Dec 18, 2009 2009-12-18
## 3                Black Panther (Disney) Feb 16, 2018 2018-02-16
## 4       Avengers: Infinity War (Disney) Apr 27, 2018 2018-04-27
## 5                   Titanic (Paramount) Dec 19, 1997 1997-12-19
## 6            Jurassic World (Universal) Jun 12, 2015 2015-06-12</code></pre>
</div>
<div id="fonctions-difftime-et-sys.date" class="section level3" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> Fonctions <code>difftime</code> et <code>Sys.Date</code></h3>
<p>Pour calculer le nombre d’années entre aujourd’hui et la date de sortie des films, tentons d’utiliser la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/difftime.html">fonction <code>difftime</code></a>. D’abord, obtenons la date courante avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Sys.time.html">fonction <code>Sys.Date</code></a>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>aujourdui <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>aujourdui</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-27&quot;</code></pre>
<p>Ensuite, demandons à <code>difftime</code> de calculer la différence, en années, entre aujourd’hui et les dates de sortie des films.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>boxoffice<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">difftime</span>(aujourdui, boxoffice<span class="sc">$</span>Date, <span class="at">units =</span> <span class="st">&quot;years&quot;</span>)</span></code></pre></div>
<pre><code>## Error in match.arg(units)\ : 
##   &#39;arg&#39; should be one of “auto”, “secs”, “mins”, “hours”, “days”, “weeks”</code></pre>
<p>La fonction <code>difftime</code> ne calcule pas de différence entre des dates en années, d’où l’erreur obtenue. Elle peut cependant calculer cette différence en jours ou en semaines (aussi en secondes, minutes ou heures si les dates comprennent aussi une heure). Pour faire un calcul approximatif, mais presque exact, du nombre d’années écoulées entre aujourd’hui et la sortie des films, nous pourrions d’abord calculer le temps écoulé en jours. Ensuite, nous pourrions diviser ce nombre de jours par 365.25 jours, soit le nombre moyen de jours dans une année.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>boxoffice<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(aujourdui, boxoffice<span class="sc">$</span>Date, <span class="at">units =</span> <span class="st">&quot;days&quot;</span>) <span class="sc">/</span> <span class="fl">365.25</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">subset</span>(boxoffice, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Ranking, Gross)))</span></code></pre></div>
<pre><code>##                       Movie_Distributor Release_Date       Date       Age
## 1 Star Wars: The Force Awakens (Disney) Dec 18, 2015 2015-12-18  4.109514
## 2                          Avatar (Fox) Dec 18, 2009 2009-12-18 10.108145
## 3                Black Panther (Disney) Feb 16, 2018 2018-02-16  1.943874
## 4       Avengers: Infinity War (Disney) Apr 27, 2018 2018-04-27  1.752225
## 5                   Titanic (Paramount) Dec 19, 1997 1997-12-19 22.105407
## 6            Jurassic World (Universal) Jun 12, 2015 2015-06-12  4.626968</code></pre>
<p>Cet âge est presque exact. Cependant, il y a une petite erreur due au fait que nous ne savons pas combien il y a eu d’années bissextiles entre aujourd’hui et la date de sortie des films. Une année ne comporte pas 365.25 jours, mais bien 365 ou 366 jours.</p>
</div>
<div id="fonction-format" class="section level3" number="1.6.3">
<h3><span class="header-section-number">1.6.3</span> Fonction <code>format</code></h3>
<p>Une date peut se présenter sous plusieurs formats, explicités dans la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/strptime.html">fiche d’aide nommée <code>strptime</code></a>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(strptime)</span></code></pre></div>
<p>Grâce à ces différents formats, nous pourrions par exemple extraire le mois de sortie d’un film grâce à la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/strptime.html">fonction <code>format</code></a> comme suit.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>boxoffice<span class="sc">$</span>Month <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(boxoffice<span class="sc">$</span>Date, <span class="st">&quot;%m&quot;</span>))</span></code></pre></div>
<p>Voyons ce que ça donne.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">subset</span>(boxoffice, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Ranking, Gross)))</span></code></pre></div>
<pre><code>##                       Movie_Distributor Release_Date       Date       Age Month
## 1 Star Wars: The Force Awakens (Disney) Dec 18, 2015 2015-12-18  4.109514    12
## 2                          Avatar (Fox) Dec 18, 2009 2009-12-18 10.108145    12
## 3                Black Panther (Disney) Feb 16, 2018 2018-02-16  1.943874     2
## 4       Avengers: Infinity War (Disney) Apr 27, 2018 2018-04-27  1.752225     4
## 5                   Titanic (Paramount) Dec 19, 1997 1997-12-19 22.105407    12
## 6            Jurassic World (Universal) Jun 12, 2015 2015-06-12  4.626968     6</code></pre>
<p><strong>Note</strong> : Il existe d’autres classes dédiées à la manipulation de dates en R qui permettent d’inclure l’heure dans la date (heure, minute, seconde) : <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/DateTimeClasses.html"><code>"POSIXlt"</code> et <code>"POSIXct"</code></a>. Avec ces classes, la prise en compte des fuseaux horaires est primordiale. Nous n’approfondirons pas l’utilisation de ces classes. Seule une petite partie des possibilités de manipulation de dates en R est abordée ici.</p>
</div>
<div id="package-lubridate" class="section level3" number="1.6.4">
<h3><span class="header-section-number">1.6.4</span> Package <code>lubridate</code></h3>
<p>Le <code>tidyverse</code> offre aussi un outil pour manipuler des dates en R : le package <a href="https://lubridate.tidyverse.org/"><code>lubridate</code></a>. Par exemple, le calcul approximatif de temps en années entre deux dates que nous avons effectué précédemment peut être fait de façon exacte avec <code>lubridate</code> comme suit.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>boxoffice<span class="sc">$</span>Date_2 <span class="ot">&lt;-</span> <span class="fu">mdy</span>(boxoffice<span class="sc">$</span>Release_Date, <span class="at">locale =</span> <span class="st">&quot;English&quot;</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>boxoffice<span class="sc">$</span>Age_2 <span class="ot">&lt;-</span> <span class="fu">time_length</span>(<span class="fu">interval</span>(<span class="at">start =</span> boxoffice<span class="sc">$</span>Date_2, <span class="at">end =</span> <span class="fu">now</span>()), <span class="st">&quot;years&quot;</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">subset</span>(boxoffice, <span class="at">select =</span> <span class="fu">c</span>(Movie_Distributor, Date, Date_2, Age, Age_2)))</span></code></pre></div>
<pre><code>##                       Movie_Distributor       Date     Date_2       Age     Age_2
## 1 Star Wars: The Force Awakens (Disney) 2015-12-18 2015-12-18  4.109514  4.109290
## 2                          Avatar (Fox) 2009-12-18 2009-12-18 10.108145 10.109290
## 3                Black Panther (Disney) 2018-02-16 2018-02-16  1.943874  1.945205
## 4       Avengers: Infinity War (Disney) 2018-04-27 2018-04-27  1.752225  1.751366
## 5                   Titanic (Paramount) 1997-12-19 1997-12-19 22.105407 22.106557
## 6            Jurassic World (Universal) 2015-06-12 2015-06-12  4.626968  4.625683</code></pre>
<p>La fonction <code>time_length</code> tient compte des années bissextiles. Elle peut aussi calculer des durées en mois tout en considérant les durées variables de ceux-ci. Remarquons que l’argument <code>locale</code> de la fonction <code>mdy</code> nous a permis de spécifier un paramètre régional s’appliquant uniquement à la conversion à effectuer. La modification d’un paramètre régional global de la session R n’est pas nécessaire avec les fonctions du packages <code>lubridate</code>. Des références sont fournies à la fin de ce document pour en apprendre davantage sur le package <code>lubridate</code>.</p>
<hr />
</div>
</div>
</div>
<div id="manipulation-de-jeux-de-données" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Manipulation de jeux de données</h1>
<p>Nous venons de voir différentes façons de manipuler des variables dans un jeu de données sous forme de data frame. Voyons maintenant différentes manipulations usuelles de jeux de données entiers, soit :</p>
<ul>
<li>le retrait d’observations dupliquées ou contenant des données manquantes,</li>
<li>la sélection de sous-ensembles du jeu de données,</li>
<li>la fusion de plusieurs jeux de données,</li>
<li>la modification de l’ordre des observations ou des variables dans un jeu de données,</li>
<li>la modification de la mise en forme de jeux de données.</li>
</ul>
<p>Pour illustrer des manipulations, reprenons le data frame <code>data_ex</code> créé dans le cours concernant la <a href="https://stt4230.rbind.io/manipulation_donnees/lecture_ecriture_r/#lecture-de-fichiers">lecture et l’écriture dans des fichiers externes à partir de R</a>, en modifiant une valeur afin d’introduire une observation dupliquée.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>de_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>de_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)  <span class="co"># 5e valeur pas comme dans les notes précédentes</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>lanceur <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Luc&quot;</span>, <span class="st">&quot;Kim&quot;</span>), <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>data_ex <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">de1 =</span> de_1, <span class="at">de2 =</span> de_2, <span class="at">lanceur =</span> lanceur)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Introduction de valeurs manquantes</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>data_ex<span class="sc">$</span>de2[<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>data_ex<span class="sc">$</span>lanceur[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du date frame</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>data_ex</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<div id="omission-dobservations" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Omission d’observations</h2>
<div id="retrait-des-observations-dupliquées" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Retrait des observations dupliquées</h3>
<p>Il est parfois utile de gérer les observations dupliquées dans un jeu de données. En R, les fonctions suivantes sont utiles avec des observations dupliquées :</p>
<ul>
<li>pour tester la présence d’observations dupliquées : <code>duplicated</code>,</li>
<li>pour retirer les observations dupliquées : <code>unique</code>.</li>
</ul>
<p>Une observation est ici définie par l’ensemble des valeurs observées de toutes les variables pour un individu (ou une unité) de la population statistique à l’étude. Donc une observation dupliquée est une ligne répétée (donc deux lignes ou plus complètement identiques) dans une matrice ou un data frame. Dans le cas d’une seule variable, stockée dans un vecteur, une observation dupliquée est une valeur présente plus d’une fois dans le vecteur.</p>
<p>Dans le jeu de données <code>data_ex</code>, les lignes 1 et 5 de sont identiques. La fonction <code>duplicated</code> identifie la 5e observation comme une duplication d’une autre observation.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">duplicated</span>(data_ex)</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE</code></pre>
<p>L’observation peut être retirée avec la fonction <code>unique</code> comme suit.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(data_ex)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>Si elles reçoivent un vecteur en entrée, les fonctions <code>duplicated</code> et <code>unique</code> réagissent comme suit.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">duplicated</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 1 3 2</code></pre>
</div>
<div id="retrait-des-observations-avec-données-manquantes" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Retrait des observations avec données manquantes</h3>
<p>Comme pour les observations dupliquées, il existe des outils en R pour identifier ou retirer les observations contenant des données manquantes :</p>
<ul>
<li>pour identifier les observations sans données manquantes : <code>complete.cases</code>,</li>
<li>pour retirer les observations contenant au moins une donnée manquante : <code>na.omit</code>.</li>
</ul>
<p>Dans le jeu de données <code>data_ex</code>, les lignes 3 et 7 contiennent chacune une donnée manquante. La fonction <code>complete.cases</code> identifie ces lignes comme n’étant pas des cas complets (<code>FALSE</code> retourné pour les lignes contenant des <code>NA</code>).</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete.cases</span>(data_ex)</span></code></pre></div>
<pre><code>##  [1]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE</code></pre>
<p>Ces deux observations peuvent facilement être retirées avec la fonction <code>na.omit</code> comme suit.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(data_ex)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>La fonction <code>na.omit</code> a déjà été vue dans les <a href="https://stt4230.rbind.io/calculs/calculs_stat_r/#traitement-des-donn%C3%A9es-manquantes-et-argument-na.rm">notes sur les calculs statistiques en R</a>). Cette fonction ajoute des attributs à l’objet retourné pour identifier les observations omises.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>data_ex_no_NA <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(data_ex)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_ex_no_NA)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    8 obs. of  3 variables:
##  $ de1    : num  2 3 1 2 3 6 5 4
##  $ de2    : num  1 4 3 1 4 2 5 3
##  $ lanceur: chr  &quot;Luc&quot; &quot;Luc&quot; &quot;Luc&quot; &quot;Luc&quot; ...
##  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:2] 3 7
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;3&quot; &quot;7&quot;</code></pre>
<p>Les fonctions <code>complete.cases</code> et <code>na.omit</code> fonctionnent aussi avec des vecteurs, comme le montre ces exemples.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete.cases</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>))  <span class="co"># équivalent à !is.na(c(1, 3, 2, NA, 2, 1))</span></span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 1 3 2 2 1
## attr(,&quot;na.action&quot;)
## [1] 4
## attr(,&quot;class&quot;)
## [1] &quot;omit&quot;</code></pre>
<p>La fonction <code>is.na</code> (vue dans les <a href="https://stt4230.rbind.io/calculs/calculs_math_r/#fonctions-de-comparaison-pour-constantes-sp%C3%A9ciales">notes sur les calculs mathématiques en R</a>), utilisée avec l’opérateur <code>[</code>, permet aussi de retirer les données manquantes d’un vecteur.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">!</span><span class="fu">is.na</span>(x)]</span></code></pre></div>
<pre><code>## [1] 1 3 2 2 1</code></pre>
<p>Remarquons que cette solution de rechange à <code>na.omit</code> n’ajoute pas d’attributs au résultat.</p>
</div>
</div>
<div id="sélection-de-sous-ensembles-de-données" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Sélection de sous-ensembles de données</h2>
<p>Sélectionner un sous-ensemble de données signifie <strong>extraire</strong> d’un jeu de données une partie des observations (lignes) et/ou des variables (colonnes) qu’il contient. La sélection d’observations répondant à certains critères est aussi parfois appelée <strong>filtrage</strong> de données. La matière couverte dans les notes sur les calculs de base en R concernant les <a href="https://stt4230.rbind.io/calculs/calculs_base_r/#conditions-logiques">conditions logiques</a> nous sera très utile pour tester des critères.</p>
<div id="opérateur-et-fonction-subset" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Opérateur <code>[</code> et fonction <code>subset</code></h3>
<p>Les principaux outils permettant d’extraire des sous-ensembles de données stockées dans un data frame ont déjà été présentés dans les notes sur les
structures de données en R. Il s’agit de <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#extraction-d%C3%A9l%C3%A9ments">l’opérateur d’indiçage <code>[</code> et de la fonction d’extraction <code>subset</code></a>. La fonction <code>subset</code> a d’ailleurs été utilisée dans les derniers exemples pour sélectionner seulement certaines variables dans l’affichage des résultats.</p>
<p>Pour illustrer l’utilisation de ces outils dans un contexte de sélection de sous-ensembles de données, voyons comment conserver du jeu de données <code>data_ex</code> seulement les résultats de lancers de dés effectués par Kim et ne comprenant aucune donnée manquante. Dans ce sous-ensemble, la variable <code>lanceur</code> prendra toujours la même valeur. Elle ne sera donc plus vraiment pertinente et sera retirée.</p>
<p>Tout d’abord, voyons comment effectuer cette tâche avec l’opérateur <code>[</code>, étape par étape. Pour limiter les observations à celles pour lesquelles la variable <code>lanceur</code> prend la valeur <code>Kim</code>, nous écrivons la condition logique représentant ce critère et la fournissons au premier argument de l’opérateur <code>[</code> à plusieurs dimensions.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>data_ex[data_ex<span class="sc">$</span>lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>, ]</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## NA  NA  NA    &lt;NA&gt;
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>Remarquons que l’observation pour laquelle la valeur de la variable <code>lanceur</code> est manquante a été conservée. Ensuite, la façon la plus simple de retirer les lignes comprenant au moins une donnée manquante est d’utiliser la fonction <code>na.omit</code> mentionnée précédemment.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(data_ex[data_ex<span class="sc">$</span>lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>, ])</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 6    3   4     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>Finalement, la variable lanceur peut être retirée en fournissant les noms des autres variables, celles à conserver, au deuxième argument de l’opérateur <code>[</code>. Dans un cas de manipulation de data frame, l’identification des variables par leur nom plutôt que par leur position permet d’éviter des erreurs.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(data_ex[data_ex<span class="sc">$</span>lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>)])</span></code></pre></div>
<pre><code>##    de1 de2
## 6    3   4
## 8    6   2
## 9    5   5
## 10   4   3</code></pre>
<p>Effectuons maintenant le même travail avec la fonction <code>subset</code>, encore une fois étape par étape, pour bien comprendre les traitements réalisés.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(data_ex, <span class="at">subset =</span> lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>Tout d’abord, remarquons que le comportement de la fonction <code>subset</code> diffère un peu de celui de l’opérateur <code>[</code>. L’observation pour laquelle la valeur de la variable <code>lanceur</code> est manquante n’a pas été conservée. Nous pourrions retirer les observations contenant des valeurs manquantes pour les autres variables en combinant des conditions logiques comme suit.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(data_ex, <span class="at">subset =</span> <span class="sc">!</span><span class="fu">is.na</span>(de1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(de2) <span class="sc">&amp;</span> lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 6    3   4     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>Cependant, il est plus simple d’utiliser encore une fois la fonction <code>na.omit</code>. Pour retirer la variable <code>lanceur</code>, l’argument <code>select</code> de la fonction <code>subset</code> peut être spécifié comme dans la commande suivante, qui accompli la tâche souhaitée.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(<span class="fu">subset</span>(data_ex, <span class="at">subset =</span> lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>, <span class="at">select =</span> <span class="sc">-</span>lanceur))</span></code></pre></div>
<pre><code>##    de1 de2
## 6    3   4
## 8    6   2
## 9    5   5
## 10   4   3</code></pre>
<p>La possibilité de pouvoir retirer des variables en utilisant l’opérateur <code>-</code> devant leur nom permet de simplifier des commandes. Pour conserver ou retirer plus d’une variable, il faut fournir leurs noms dans un vecteur, comme nous l’avons fait précédemment dans la commande suivante (non exécutée ici).</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">subset</span>(boxoffice, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Ranking, Gross)))</span></code></pre></div>
</div>
<div id="fonctions-filter-et-select-du-package-dplyr" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Fonctions <code>filter</code> et <code>select</code> du package <code>dplyr</code></h3>
<p>Le package <code>dplyr</code> attribue les tâches de sélection d’observations et de variables à deux fonctions distinctes :</p>
<ul>
<li><a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter</code></a> pour la sélection d’observations (lignes),</li>
<li><a href="https://dplyr.tidyverse.org/reference/select.html"><code>select</code></a> pour la sélection de variables (colonnes).</li>
</ul>
<p>Par exemple, nous pouvons sélectionner les observations de <code>data_ex</code> pour lesquelles la valeur de la variable <code>lancer</code> est <code>"Kim"</code> avec la fonction <code>filter</code> comme suit.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(data_ex, lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>)</span></code></pre></div>
<pre><code>##   de1 de2 lanceur
## 1   3   4     Kim
## 2   5  NA     Kim
## 3   6   2     Kim
## 4   5   5     Kim
## 5   4   3     Kim</code></pre>
<p>Tout comme le fait la fonction <code>subset</code>, les lignes pour lesquelles la condition vaut <code>NA</code> n’ont pas été conservées. Pour retirer les observations contenant des données manquantes, nous pouvons utiliser <code>na.omit</code>, ou encore <a href="https://tidyr.tidyverse.org/reference/drop_na.html"><code>drop_na</code></a>, une fonction similaire contenue dans le package <code>tidyr</code>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop_na</span>(<span class="fu">filter</span>(data_ex, lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>))</span></code></pre></div>
<pre><code>##   de1 de2 lanceur
## 1   3   4     Kim
## 2   6   2     Kim
## 3   5   5     Kim
## 4   4   3     Kim</code></pre>
<p>Notons que la fonction <code>drop_na</code> permet de limiter la recherche de valeurs manquantes à un sous-ensemble de variables, ce qui n’est pas possible avec <code>na.omit</code>.</p>
<p>Ensuite, la variable <code>lanceur</code> peut être retirée à l’aide de la fonction <code>select</code> comme suit.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">drop_na</span>(<span class="fu">filter</span>(data_ex, lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>)), <span class="sc">-</span>lanceur)</span></code></pre></div>
<pre><code>##   de1 de2
## 1   3   4
## 2   6   2
## 3   5   5
## 4   4   3</code></pre>
<p>Cette commande est un peu difficile à lire en raison du grand nombre d’appels de fonctions imbriqués qu’elle contient. Elle serait peut-être plus claire en ajoutant des retours à la ligne et des indentations comme suit.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>      data_ex, </span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>      lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>lanceur</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   de1 de2
## 1   3   4
## 2   6   2
## 3   5   5
## 4   4   3</code></pre>
<p>La pratique courante avec les packages du <code>tidyverse</code> est cependant d’utiliser l’<a href="https://magrittr.tidyverse.org/">opérateur « pipe » <code>%&gt;%</code></a> du package <code>magrittr</code> pour rendre les commandes plus lisibles. En utilisant cet opérateur, la commande aurait l’allure suivante.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>data_ex <span class="sc">%&gt;%</span> <span class="fu">filter</span>(lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>lanceur) </span></code></pre></div>
<pre><code>##   de1 de2
## 1   3   4
## 2   6   2
## 3   5   5
## 4   4   3</code></pre>
<p>Je ne fais que mentionner cet opérateur ici. Il est recommandé, mais pas obligatoire, de l’employer lors de l’utilisation de packages du <code>tidyverse</code>. L’utilisation de cet opérateur est expliqué dans les <a href="https://stt4230.rbind.io/amelioration_code/bonnes_pratiques_r/#op%C3%A9rateur-pipe">notes sur les bonnes pratiques de programmation en R</a>.</p>
</div>
<div id="opérateur-et-fonction-subset-du-package-data.table" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Opérateur <code>[</code> et fonction <code>subset</code> du package <code>data.table</code></h3>
<p>Pour effectuer de la sélection de sous-ensembles de données avec la package <code>data.table</code>, nous pouvons exploiter son <a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">opérateur <code>[</code> et ses arguments <code>i</code> et <code>j</code></a> ou encore sa <a href="https://rdatatable.gitlab.io/data.table/reference/subset.data.table.html">méthode pour la fonction <code>subset</code></a> (qui est en fait une fonction générique) spécifique aux data tables. Illustrons ici l’utilisation de l’opérateur <code>[</code>. La fonction <code>subset</code> s’utilise à peu près de la même façon avec un data table qu’avec un data frame.</p>
<p>Après avoir transformé le data frame <code>data_ex</code> en data table,</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>data_ex_dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(data_ex)</span></code></pre></div>
<p>nous pouvons l’indicer à l’aide de l’opérateur <code>[</code> de <code>data.table</code> en fournissant une condition logique à l’argument <code>i</code> pour sélectionner des lignes.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>data_ex_dt[i <span class="ot">=</span> lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>]</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1:   3   4     Kim
## 2:   5  NA     Kim
## 3:   6   2     Kim
## 4:   5   5     Kim
## 5:   4   3     Kim</code></pre>
<p>Dans les commandes suivantes, je vais omettre l’assignation explicite à l’argument <code>i</code> puisque ce n’est vraiment pas une pratique courante d’inclure cette assignation dans un appel à <code>[</code>. Selon l’ordre des arguments de l’opérateur dans sa définition (voir la section Usage de sa <a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">fiche d’aide</a>), la première valeur fournie après <code>[</code> est assignée à l’argument <code>i</code> et la deuxième à l’argument <code>j</code> si elles ne sont pas explicitement assignées à un nom d’argument (et si aucune valeur fournie en troisième position ou plus loin n’est assignée à <code>i</code> ou <code>j</code>, selon les <a href="https://stt4230.rbind.io/introduction/base_r/#%C3%A9criture-dun-appel-%C3%A0-une-fonction">règles d’assignation implicite de valeurs aux arguments</a> présentée dans les notes sur les concepts de base en R).</p>
<p>Le package <code>data.table</code> offre une <a href="https://rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">méthode pour la fonction <code>na.omit</code></a> spécifique aux data tables.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(data_ex_dt[lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>])</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1:   3   4     Kim
## 2:   6   2     Kim
## 3:   5   5     Kim
## 4:   4   3     Kim</code></pre>
<p>La sélection de variables dans un data table s’effectue en fournissant une valeur à l’argument <code>j</code>. Par exemple, nous pouvons sélectionner les variables <code>de1</code> et <code>de2</code> de <code>data_ex_dt</code> comme suit (commande non évaluée),</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(data_ex_dt[lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>, .(de1, de2)])</span></code></pre></div>
<p>ou encore omettre la variable <code>lanceur</code>, comme suit.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(data_ex_dt[lanceur <span class="sc">==</span> <span class="st">&quot;Kim&quot;</span>, <span class="sc">!</span><span class="fu">c</span>(<span class="st">&quot;lanceur&quot;</span>)])</span></code></pre></div>
<pre><code>##    de1 de2
## 1:   3   4
## 2:   6   2
## 3:   5   5
## 4:   4   3</code></pre>
<p>Remarquons que l’omission de variables s’indique avec l’opérateur <code>!</code> avec <code>data.table</code>, plutôt qu’avec <code>-</code>.</p>
</div>
</div>
<div id="combinaison-de-données" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Combinaison de données</h2>
<p>Combiner des données signifie de mettre en commun deux jeux de données ou plus. Ils peuvent être mis en commun par une simple concaténation, c’est-à-dire une mise bout à bout, de lignes ou de colonnes. Ils peuvent aussi être fusionnés par association en tenant compte des valeurs prises par des variables communes aux jeux de données.</p>
<div id="concaténation-dobservations-lignes---fonction-rbind" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Concaténation d’observations (lignes) - Fonction <code>rbind</code></h3>
<p>Supposons que nous avons en main deux jeux de données contenant différentes observations pour les mêmes variables. Par exemple, en plus du data frame <code>data_ex</code>, disons que nous avons les observations supplémentaires suivantes.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>supp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">de1 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>), <span class="at">lanceur =</span> <span class="fu">c</span>(<span class="st">&quot;Luc&quot;</span>, <span class="st">&quot;Kim&quot;</span>), <span class="at">de2 =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>supp</span></code></pre></div>
<pre><code>##   de1 lanceur de2
## 1   2     Luc   5
## 2   5     Kim   6</code></pre>
<p>Pour concaténer les jeux de données <code>data_ex</code> et <code>supp</code> en un seul jeu de données, nous pourrions utiliser la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/cbind.html">fonction <code>rbind</code></a> comme suit :</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(data_ex, supp)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim
## 11   2   5     Luc
## 12   5   6     Kim</code></pre>
<p>Remarquons que <code>rbind</code> a su mettre dans les mêmes colonnes les observations des variables portant les mêmes noms, même si elles n’étaient pas dans le même ordre dans les deux jeux de données à combiner.</p>
<p>Il serait maintenant judicieux d’assigner cette concaténation à un nom afin de conserver le résultat obtenu dans un objet. Si nous assignions cet appel à <code>rbind</code> au nom <code>data_ex</code>, le jeu de données <code>data_ex</code> d’origine serait remplacé par le résultat de la concaténation. Nous pourrions aussi créer un nouvel objet pour stocker le résultat.</p>
</div>
<div id="concaténation-de-variables-colonnes---fonction-cbind-ou-data.table" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Concaténation de variables (colonnes) - Fonction <code>cbind</code> ou <code>data.table</code></h3>
<p>Lorsque nous avons ajouté des variables à un jeu de données dans la section précédente, nous avons réalisé une forme de concaténation de jeux de données en colonnes. Voici une copie d’un exemple réalisé.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(cars, <span class="at">dist_m =</span> cars<span class="sc">$</span>dist <span class="sc">*</span> <span class="fl">0.3048</span>)</span></code></pre></div>
<p>Dans cette forme de concaténation, le deuxième jeu de données fusionné est constitué d’une seule variable, stockée dans un vecteur, et le résultat de la concaténation remplace le premier jeu de données fusionné.</p>
<p>La concaténation de variables peut être plus générale que ça. Nous pourrions concaténer deux jeux de données contenant chacun plus d’une variable et stocker le résultat de la concaténation dans un nouvel objet.</p>
<p>Par exemple, disons que nous avons un jeu de données contenant des informations sur les lanceurs de dés du jeu de données <code>data_ex</code>.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>data_ex_lanceurs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">lateralite =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;gaucher&quot;</span>, <span class="st">&quot;droitier&quot;</span>), <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">51</span>), <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>data_ex_lanceurs</span></code></pre></div>
<pre><code>##    lateralite age
## 1     gaucher  22
## 2     gaucher  22
## 3     gaucher  22
## 4     gaucher  22
## 5     gaucher  22
## 6    droitier  51
## 7    droitier  51
## 8    droitier  51
## 9    droitier  51
## 10   droitier  51</code></pre>
<p>Pour concaténer en colonnes les jeux de données <code>data_ex</code> et <code>data_ex_lanceurs</code>, nous pourrions utiliser la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/cbind.html">fonction <code>cbind</code></a> ou <code>data.frame</code> comme suit.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(data_ex, data_ex_lanceurs)</span></code></pre></div>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ou encore</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(data_ex, data_ex_lanceurs)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur lateralite age
## 1    2   1     Luc    gaucher  22
## 2    3   4     Luc    gaucher  22
## 3    4   2    &lt;NA&gt;    gaucher  22
## 4    1   3     Luc    gaucher  22
## 5    2   1     Luc    gaucher  22
## 6    3   4     Kim   droitier  51
## 7    5  NA     Kim   droitier  51
## 8    6   2     Kim   droitier  51
## 9    5   5     Kim   droitier  51
## 10   4   3     Kim   droitier  51</code></pre>
<p>Le résultat de la concaténation pourrait être assigné à un nom d’objet R existant ou à un nouveau nom, créant du coup un nouvel objet.</p>
</div>
<div id="fusion-par-association---fonction-merge" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Fusion par association - Fonction <code>merge</code></h3>
<p>Une concaténation de variables crée un jeu de données utile seulement si les valeurs sur une même ligne réfèrent toutes à un même individu (ou unité statistique) et les valeurs sur une même colonne à une même variable. Par exemple, le résultat que nous venons d’obtenir nous porte à croire que Luc est gaucher et qu’il a 22 ans, et que Kim est droitière et a 51 ans. Mais rien dans le jeu de données <code>data_ex_lanceurs</code> ne dit à quels lanceurs correspondent les caractéristiques. Et la ligne 3 de ce jeu de données est surprenante. Le nom du lanceur est manquant, mais sa latéralité et son âge sont connus.</p>
<p>Avec une fusion par concaténation de variables, les risques d’erreurs sont présents. Il est plus prudent de fusionner des jeux de données en spécifiant par rapport à quelles variables établir les correspondances entre les lignes des deux jeux de données. Appelons ce type de combinaison de données jointure ou fusion par association. Une telle fusion peut s’effectuer en R avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/merge.html">fonction <code>merge</code></a>.</p>
<p>Dans l’exemple précédent, nous aurions préféré fusionner le jeu de données <code>data_ex</code> au jeu de données suivant.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>lanceurs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nom =</span> <span class="fu">c</span>(<span class="st">&quot;Luc&quot;</span>, <span class="st">&quot;Kim&quot;</span>),</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">lateralite =</span> <span class="fu">c</span>(<span class="st">&quot;gaucher&quot;</span>, <span class="st">&quot;droitier&quot;</span>),</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">51</span>)</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>lanceurs</span></code></pre></div>
<pre><code>##   nom lateralite age
## 1 Luc    gaucher  22
## 2 Kim   droitier  51</code></pre>
<p>Ce jeu de données indique clairement à quel lanceur sont associées les différentes caractéristiques.</p>
<p>Une fusion par association selon la valeur de la variable identifiant le lanceur entre les data frames <code>data_ex</code> et <code>lanceurs</code> peut s’effectuer comme suit.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> data_ex, <span class="at">y =</span> lanceurs, </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="st">&quot;lanceur&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;nom&quot;</span>, </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="cn">TRUE</span>, <span class="at">sort =</span> <span class="cn">FALSE</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##    lanceur de1 de2 lateralite age
## 1      Luc   2   1    gaucher  22
## 2      Luc   3   4    gaucher  22
## 3      Luc   1   3    gaucher  22
## 4      Luc   2   1    gaucher  22
## 5      Kim   3   4   droitier  51
## 6      Kim   5  NA   droitier  51
## 7      Kim   6   2   droitier  51
## 8      Kim   5   5   droitier  51
## 9      Kim   4   3   droitier  51
## 10    &lt;NA&gt;   4   2       &lt;NA&gt;  NA</code></pre>
<p>Ici, étant donné que la variable selon laquelle établir les correspondances ne porte pas le même nom dans les deux jeux de données, nous avons dû spécifier les arguments <code>by.x</code> et <code>by.y</code>. Ces arguments prennent comme valeur un vecteur contenant les noms des variables d’association dans le jeu de données fourni en entrée à l’argument <code>x</code> pour <code>by.x</code> et <code>y</code> pour <code>by.y</code>. Lorsque les variables d’association portent le même nom partout, seul l’argument <code>by</code> a besoin d’être spécifié. Si aucune valeur n’est fournie aux arguments <code>by.x</code> et <code>by.y</code> ou <code>by</code>, les variables utilisées pour associer les lignes sont celles portant le même nom dans les deux jeux de données.</p>
<p>L’argument <code>sort</code> permet d’indiquer à <code>merge</code> si les observations doivent être ordonnées dans la sortie (par défaut elles le sont) selon les valeurs des variables d’association. Si l’utilisateur demande à ce que les observations ne soient pas ordonnées, comme dans l’exemple précédent, les observations contenant des valeurs manquantes pour les variables d’association sont tout de même placées à la fin du data frame retourné en sortie.</p>
<p>L’argument <code>all</code> permet quant à lui de spécifier à <code>merge</code> quelles observations doivent être conservées dans la sortie. Par défaut, seules les observations ayant pu être associées à une observation de l’autre jeu de données sont conservées. Selon la <a href="https://en.wikipedia.org/wiki/Join_(SQL)">terminologie des bases de données relationnelles</a>, la fonction <code>merge</code> effectue par défaut une jointure interne (en anglais <em>inner join</em>). Dans l’exemple, nous avons plutôt spécifié <code>all = TRUE</code> afin de conserver toutes les observations des deux jeux de données. Nous avons donc effectué une jointure externe complète (en anglais <em>full outer join</em>). Avec les arguments <code>all.x</code> et <code>all.y</code>, nous aurions aussi pu effectuer des jointures externes gauches ou droites (en anglais <em>left or right outer join</em>).</p>
</div>
<div id="fonctions-de-concaténation-et-de-jointure-du-package-dplyr" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Fonctions de concaténation et de jointure du package <code>dplyr</code></h3>
<p>Le package <code>dplyr</code> propose la <a href="https://dplyr.tidyverse.org/reference/bind.html">fonction <code>bind_rows</code></a> en remplacement de <code>rbind</code> et <a href="https://dplyr.tidyverse.org/reference/bind.html"><code>bind_cols</code></a> en remplacement de <code>cbind</code>. Une capacité intéressante de <code>bind_rows</code> est d’arriver à concaténer en lignes des jeux de données ne comportant pas toutes les mêmes variables. Des valeurs manquantes sont ajoutées dans les colonnes des variables non communes aux deux jeux de données.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>supp_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(supp, <span class="at">lateralite =</span> <span class="fu">c</span>(<span class="st">&quot;gaucher&quot;</span>, <span class="st">&quot;droitier&quot;</span>))</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>supp_2</span></code></pre></div>
<pre><code>##   de1 lanceur de2 lateralite
## 1   2     Luc   5    gaucher
## 2   5     Kim   6   droitier</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(data_ex, supp_2)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur lateralite
## 1    2   1     Luc       &lt;NA&gt;
## 2    3   4     Luc       &lt;NA&gt;
## 3    4   2    &lt;NA&gt;       &lt;NA&gt;
## 4    1   3     Luc       &lt;NA&gt;
## 5    2   1     Luc       &lt;NA&gt;
## 6    3   4     Kim       &lt;NA&gt;
## 7    5  NA     Kim       &lt;NA&gt;
## 8    6   2     Kim       &lt;NA&gt;
## 9    5   5     Kim       &lt;NA&gt;
## 10   4   3     Kim       &lt;NA&gt;
## 11   2   5     Luc    gaucher
## 12   5   6     Kim   droitier</code></pre>
<p>Le fonction <code>bind_rows</code> peut aussi ajouter une colonne dans le résultat de la concaténation pour identifier la provenance des lignes grâce à son argument <code>.id</code>.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">jeu1 =</span> data_ex, <span class="at">jeu2 =</span> supp_2, <span class="at">.id =</span> <span class="st">&quot;origine&quot;</span>)</span></code></pre></div>
<pre><code>##    origine de1 de2 lanceur lateralite
## 1     jeu1   2   1     Luc       &lt;NA&gt;
## 2     jeu1   3   4     Luc       &lt;NA&gt;
## 3     jeu1   4   2    &lt;NA&gt;       &lt;NA&gt;
## 4     jeu1   1   3     Luc       &lt;NA&gt;
## 5     jeu1   2   1     Luc       &lt;NA&gt;
## 6     jeu1   3   4     Kim       &lt;NA&gt;
## 7     jeu1   5  NA     Kim       &lt;NA&gt;
## 8     jeu1   6   2     Kim       &lt;NA&gt;
## 9     jeu1   5   5     Kim       &lt;NA&gt;
## 10    jeu1   4   3     Kim       &lt;NA&gt;
## 11    jeu2   2   5     Luc    gaucher
## 12    jeu2   5   6     Kim   droitier</code></pre>
<p>De plus, au lieu d’offrir une seule fonction capable d’effectuer plusieurs types de fusions par association, le package <code>dplyr</code> comporte plusieurs <a href="https://dplyr.tidyverse.org/reference/join.html">fonctions de jointure</a> effectuant chacune un seul type de jointure, identifié par le nom de la fonction : <code>inner_join</code>, <code>full_join</code>, <code>left_join</code>, <code>right_join</code>, etc. L’exemple de fusion par association effectué avec <code>merge</code> se reproduit comme suit avec une fonction de <code>dplyr</code>.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(<span class="at">x =</span> data_ex, <span class="at">y =</span> lanceurs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;lanceur&quot;</span> <span class="ot">=</span> <span class="st">&quot;nom&quot;</span>))</span></code></pre></div>
<pre><code>##    de1 de2 lanceur lateralite age
## 1    2   1     Luc    gaucher  22
## 2    3   4     Luc    gaucher  22
## 3    4   2    &lt;NA&gt;       &lt;NA&gt;  NA
## 4    1   3     Luc    gaucher  22
## 5    2   1     Luc    gaucher  22
## 6    3   4     Kim   droitier  51
## 7    5  NA     Kim   droitier  51
## 8    6   2     Kim   droitier  51
## 9    5   5     Kim   droitier  51
## 10   4   3     Kim   droitier  51</code></pre>
<p>Contrairement à <code>merge</code>, les fonctions de jointure de <code>dplyr</code> ne modifient aucunement l’ordre des variables et l’ordre des observations. Ainsi, la ou les variables d’association ne sont pas placées au début et les observations avec des valeurs d’association manquantes ne sont pas placées à la fin dans le jeu de données produit en sortie.</p>
</div>
<div id="fonctions-rbindlist-et-merge-du-package-data.table" class="section level3" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Fonctions <code>rbindlist</code> et <code>merge</code> du package <code>data.table</code></h3>
<p>Le package <code>data.table</code> contient la <a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html">fonction <code>rbindlist</code></a>, qui est une solution de rechange à <code>rbind</code> du R de base ou <code>bind_rows</code> de <code>dplyr</code>. Elle a les mêmes capacités que cette dernière.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbindlist</span>(<span class="fu">list</span>(<span class="at">jeu1 =</span> data_ex, <span class="at">jeu2 =</span> supp_2), <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">idcol =</span> <span class="st">&quot;origine&quot;</span>)</span></code></pre></div>
<pre><code>##     origine de1 de2 lanceur lateralite
##  1:    jeu1   2   1     Luc       &lt;NA&gt;
##  2:    jeu1   3   4     Luc       &lt;NA&gt;
##  3:    jeu1   4   2    &lt;NA&gt;       &lt;NA&gt;
##  4:    jeu1   1   3     Luc       &lt;NA&gt;
##  5:    jeu1   2   1     Luc       &lt;NA&gt;
##  6:    jeu1   3   4     Kim       &lt;NA&gt;
##  7:    jeu1   5  NA     Kim       &lt;NA&gt;
##  8:    jeu1   6   2     Kim       &lt;NA&gt;
##  9:    jeu1   5   5     Kim       &lt;NA&gt;
## 10:    jeu1   4   3     Kim       &lt;NA&gt;
## 11:    jeu2   2   5     Luc    gaucher
## 12:    jeu2   5   6     Kim   droitier</code></pre>
<p>Le package <code>data.table</code> comporte aussi une <a href="https://rdatatable.gitlab.io/data.table/reference/merge.html">méthode pour la fonction <code>merge</code></a> spécifique aux data tables qui s’utilise de la même façon que la méthode <code>merge</code> pour data frames (celle dont nous avons parlé précédemment).</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>lanceurs_dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(lanceurs)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> data_ex_dt, <span class="at">y =</span> lanceurs_dt, </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by.x =</span> <span class="st">&quot;lanceur&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;nom&quot;</span>, </span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="cn">TRUE</span>, <span class="at">sort =</span> <span class="cn">FALSE</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##     lanceur de1 de2 lateralite age
##  1:     Luc   2   1    gaucher  22
##  2:     Luc   3   4    gaucher  22
##  3:    &lt;NA&gt;   4   2       &lt;NA&gt;  NA
##  4:     Luc   1   3    gaucher  22
##  5:     Luc   2   1    gaucher  22
##  6:     Kim   3   4   droitier  51
##  7:     Kim   5  NA   droitier  51
##  8:     Kim   6   2   droitier  51
##  9:     Kim   5   5   droitier  51
## 10:     Kim   4   3   droitier  51</code></pre>
<p>Il est aussi possible de fusionner des données avec l’opérateur <code>[</code> du package <code>data.table</code> et son argument <code>on</code>, mais cette fonctionnalité ne sera pas illustrée ici.</p>
</div>
</div>
<div id="modification-de-lordre-des-données" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Modification de l’ordre des données</h2>
<p>Il existe différentes fonctions en R pour ordonner les éléments d’un objet.</p>
<div id="fonction-rev" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Fonction <code>rev</code></h3>
<p>Une des fonctions les plus simples pour effectuer un ordonnancement d’éléments est la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/rev.html">fonction <code>rev</code></a>, qui renverse l’ordre des éléments d’un vecteur (ou un facteur).</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>data_ex<span class="sc">$</span>de1</span></code></pre></div>
<pre><code>##  [1] 2 3 4 1 2 3 5 6 5 4</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rev</span>(data_ex<span class="sc">$</span>de1)</span></code></pre></div>
<pre><code>##  [1] 4 5 6 5 3 2 1 4 3 2</code></pre>
</div>
<div id="fonction-sort" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Fonction <code>sort</code></h3>
<p>Pour effectuer l’ordonnancement des éléments d’un vecteur (ou un facteur) selon les valeurs des données en éléments, de façon à replacer les éléments en ordre croissant ou décroissant de valeur, il faut plutôt utiliser la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/sort.html">fonction <code>sort</code></a>. Par exemple, ordonnons des valeurs numériques en ordre décroissant.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>data_ex<span class="sc">$</span>de1</span></code></pre></div>
<pre><code>##  [1] 2 3 4 1 2 3 5 6 5 4</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(data_ex<span class="sc">$</span>de1, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] 6 5 5 4 4 3 3 2 2 1</code></pre>
<p>Par défaut, l’ordre croissant est retourné. Alors pour obtenir un ordre décroissant, il faut spécifier <code>decreasing = TRUE</code>.</p>
<p>Nous avons vu dans les <a href="https://stt4230.rbind.io/calculs/calculs_math_r/#op%C3%A9rateurs-de-comparaison">notes sur les calculs mathématiques en R</a> comment connaître l’ordre utilisé par notre session R pour classer des caractères. Rappelons qu’il suffit de fournir à la fonction <code>sort</code> un vecteur contenant tous les caractères potentiels, par exemple.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>caracteres_speciaux <span class="ot">&lt;-</span> </span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;!&quot;</span>, <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;#&quot;</span>, <span class="st">&quot;$&quot;</span>, <span class="st">&quot;%&quot;</span>, <span class="st">&quot;&amp;&quot;</span>, <span class="st">&quot;&#39;&quot;</span>, <span class="st">&quot;(&quot;</span>, <span class="st">&quot;)&quot;</span>, <span class="st">&quot;*&quot;</span>, <span class="st">&quot;+&quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="st">&quot;:&quot;</span>, <span class="st">&quot;;&quot;</span>, </span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&lt;&quot;</span>, <span class="st">&quot;=&quot;</span>,<span class="st">&quot;&gt;&quot;</span>, <span class="st">&quot;?&quot;</span>, <span class="st">&quot;@&quot;</span>, <span class="st">&quot;[&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>, <span class="st">&quot;]&quot;</span>, <span class="st">&quot;^&quot;</span>, <span class="st">&quot;_&quot;</span>, <span class="st">&quot;{&quot;</span>, <span class="st">&quot;|&quot;</span>, <span class="st">&quot;}&quot;</span>, <span class="st">&quot;~&quot;</span>)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>lettres_accentuees <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;à&quot;</span>, <span class="st">&quot;â&quot;</span>, <span class="st">&quot;é&quot;</span>, <span class="st">&quot;è&quot;</span>, <span class="st">&quot;ê&quot;</span>, <span class="st">&quot;ë&quot;</span>, <span class="st">&quot;ï&quot;</span>, <span class="st">&quot;î&quot;</span>, <span class="st">&quot;ô&quot;</span>, <span class="st">&quot;ù&quot;</span>, <span class="st">&quot;ü&quot;</span>, <span class="st">&quot;û&quot;</span>, <span class="st">&quot;ç&quot;</span>)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>catacteres_ordonnes <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(caracteres_speciaux, <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>, letters, LETTERS, </span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>                              lettres_accentuees, <span class="fu">toupper</span>(lettres_accentuees))) </span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(catacteres_ordonnes, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Dans cette commande, l’appel à la fonction <code>paste</code> sert uniquement à raccourcir la sortie en mettant bout à bout les caractères ordonnés dans une seule chaîne de caractères. J’obtiens le résultat suivant, qui sera peut-être différent sur votre ordinateur si vous n’avez pas les mêmes paramètres régionaux que moi.</p>
<pre><code>&quot;&#39;-!\&quot;#$%&amp;()*,./:;?@[\]^_{|}~+&lt;=&gt;0123456789aAàÀâÂbBcCçÇdDeEéÉèÈêÊëËfFgGhHiIîÎïÏjJkKlLmM
nNoOôÔpPqQrRsStTuUùÙûÛüÜvVwWxXyYzZ&quot;</code></pre>
<p>Ordonnons en ordre alphabétique croissant les noms des lanceurs dans le jeu de données <code>data_ex</code>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>data_ex<span class="sc">$</span>lanceur</span></code></pre></div>
<pre><code>##  [1] &quot;Luc&quot; &quot;Luc&quot; NA    &quot;Luc&quot; &quot;Luc&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot;</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(data_ex<span class="sc">$</span>lanceur)</span></code></pre></div>
<pre><code>## [1] &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Luc&quot; &quot;Luc&quot; &quot;Luc&quot; &quot;Luc&quot;</code></pre>
<p>Remarquons que la valeur manquante est omise dans la sortie. C’est le comportement par défaut de la fonction <code>sort</code>. Pour forcer <code>sort</code> à inclure les valeurs manquantes dans la sortie, il faut lui dire où les placer avec l’argument <code>na.last</code> comme suit.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(data_ex<span class="sc">$</span>lanceur, <span class="at">na.last =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Luc&quot; &quot;Luc&quot; &quot;Luc&quot; &quot;Luc&quot; NA</code></pre>
</div>
<div id="opérateur" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Opérateur <code>[</code></h3>
<p>L’<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Extract.html">opérateur d’indiçage <code>[</code></a> a pratiquement toujours été utilisé jusqu’à maintenant comme un outil d’extraction d’éléments. Dans les <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#op%C3%A9rateurs-dindi%C3%A7age">notes sur les structures de données</a>, il a été mentionné que cet opérateur acceptait différents types de données en entrée pour identifier les éléments à extraire : entiers positifs, entiers négatifs, chaînes de caractères ou valeurs logiques. Deux de ces types de données permettent également de réordonner les éléments : les entiers positifs et les chaînes de caractères.</p>
<p>Par exemple, pour modifier l’ordre des colonnes du data frame <code>data_ex</code> afin de placer la colonne nommée <code>lanceur</code> en première position plutôt qu’en dernière, il suffirait d’utiliser l’opérateur <code>[</code> et de donner comme valeur au deuxième argument un vecteur contenant les noms des colonnes dans l’ordre désiré, comme dans cet exemple.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame d&#39;origine</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>data_ex</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame avec colonnes réordonnées</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>data_ex[, <span class="fu">c</span>(<span class="st">&quot;lanceur&quot;</span>, <span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>)]</span></code></pre></div>
<pre><code>##    lanceur de1 de2
## 1      Luc   2   1
## 2      Luc   3   4
## 3     &lt;NA&gt;   4   2
## 4      Luc   1   3
## 5      Luc   2   1
## 6      Kim   3   4
## 7      Kim   5  NA
## 8      Kim   6   2
## 9      Kim   5   5
## 10     Kim   4   3</code></pre>
<p>Ce réordonnancement des colonnes aurait aussi pu être effectué en fournissant un vecteur de nombres entiers, comme suit.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>data_ex[, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>)]</span></code></pre></div>
<pre><code>##    lanceur de1 de2
## 1      Luc   2   1
## 2      Luc   3   4
## 3     &lt;NA&gt;   4   2
## 4      Luc   1   3
## 5      Luc   2   1
## 6      Kim   3   4
## 7      Kim   5  NA
## 8      Kim   6   2
## 9      Kim   5   5
## 10     Kim   4   3</code></pre>
<p>Cette instruction a dit à R de placer la colonne qui est à l’origine en position 3 à la position 1 (car le nombre 3 est en position 1 dans le vecteur fourni au deuxième argument de <code>[</code>), la colonne à l’origine en position 1 à la position 2 et finalement celle à l’origine en position 2 à la position 3. Nous pouvons appeler le vecteur <code>c(3, 1, 2)</code> de la commande précédente une permutation des données.</p>
<p>Une permutation fournie comme premier argument à <code>[</code> (avant la virgule) ordonne les lignes et une permutation fournie comme deuxième argument à <code>[</code> (après la virgule, comme dans l’exemple précédent) ordonne les colonnes. Les lignes et les colonnes peuvent être ordonner simultanément. Par exemple, pour déplacer en une commande la dernière observation du data frame <code>data_ex</code> en première position et la variable <code>lanceur</code> en première position, nous pouvons procéder ainsi.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>data_ex[<span class="fu">c</span>(<span class="fu">nrow</span>(data_ex), <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(data_ex) <span class="sc">-</span> <span class="dv">1</span>)), <span class="fu">c</span>(<span class="st">&quot;lanceur&quot;</span>, <span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>)]</span></code></pre></div>
<pre><code>##    lanceur de1 de2
## 10     Kim   4   3
## 1      Luc   2   1
## 2      Luc   3   4
## 3     &lt;NA&gt;   4   2
## 4      Luc   1   3
## 5      Luc   2   1
## 6      Kim   3   4
## 7      Kim   5  NA
## 8      Kim   6   2
## 9      Kim   5   5</code></pre>
<p>Notons que l’opérateur <code>[</code> permet aussi de réordonner les éléments d’un vecteur ou d’une liste, ou encore les lignes ou les colonnes d’une matrice. Pour terminer, notons également que les opérateurs d’indiçage <code>[[</code> et <code>$</code> ne permettent pas de réordonner des éléments, car ils servent à extraire un seul élément.</p>
</div>
<div id="fonction-order" class="section level3" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Fonction <code>order</code></h3>
<p>Pour modifier l’ordre des observations ou des variables dans un jeu de données R, la <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/order.html">fonction <code>order</code></a> est utile. Elle permet d’obtenir un vecteur d’indice des observations dans l’ordre désiré.</p>
<p>Par exemple, pour ordonner les observations du jeu de données <code>data_ex</code> en ordre croissant de la valeur de la variable <code>de1</code>,</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>data_ex<span class="sc">$</span>de1</span></code></pre></div>
<pre><code>##  [1] 2 3 4 1 2 3 5 6 5 4</code></pre>
<p>nous devons d’abord obtenir le vecteur d’indices suivant avec la fonction <code>order</code> :</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>permutation <span class="ot">&lt;-</span> <span class="fu">order</span>(data_ex<span class="sc">$</span>de1)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>permutation</span></code></pre></div>
<pre><code>##  [1]  4  1  5  2  6  3 10  7  9  8</code></pre>
<p>Ce vecteur s’interprète comme suit : la plus petite valeur de <code>data_ex$de1</code> se trouve en position 4 (valeur 1), les deuxièmes plus petites (valeur 2 qui revient 2 fois) se trouvent dans les positions 1 et 5, …, la plus grande valeur (6) se trouve en position 8. Ensuite, il suffit de fournir ce vecteur au premier argument de l’opérateur d’indiçage <code>[</code> pour ordonner les lignes de <code>data_ex</code>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>data_ex[permutation, ]</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 4    1   3     Luc
## 1    2   1     Luc
## 5    2   1     Luc
## 2    3   4     Luc
## 6    3   4     Kim
## 3    4   2    &lt;NA&gt;
## 10   4   3     Kim
## 7    5  NA     Kim
## 9    5   5     Kim
## 8    6   2     Kim</code></pre>
<p>Notons que nous aurions pu jumeler l’appel à <code>order</code> à l’appel à <code>[</code> comme suit :</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>data_ex[<span class="fu">order</span>(data_ex<span class="sc">$</span>de1), ]</span></code></pre></div>
<p>La fonction <code>order</code> accepte plus d’un vecteur de valeurs pour déterminer le nouvel ordre. Par exemple, la commande suivante permet d’ordonner les observations de <code>data_ex</code> en ordre croissant de valeur de la variable <code>de1</code>, en résolvant les égalités en <code>de1</code> en considérant l’ordre alphabétique croissant de la variable <code>lanceur</code>.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>data_ex[<span class="fu">order</span>(data_ex<span class="sc">$</span>de1, data_ex<span class="sc">$</span>lanceur), ]</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 4    1   3     Luc
## 1    2   1     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 2    3   4     Luc
## 10   4   3     Kim
## 3    4   2    &lt;NA&gt;
## 7    5  NA     Kim
## 9    5   5     Kim
## 8    6   2     Kim</code></pre>
<p>La fonction <code>order</code> a un argument <code>decreasing</code>, tout comme <code>sort</code>, pour demander un ordre décroissant plutôt que croissant. Par exemple, pour modifier l’ordre des colonnes de <code>data_ex</code> selon l’ordre alphabétique décroissant des noms de colonnes, nous pourrions procéder comme suit.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>data_ex[, <span class="fu">order</span>(<span class="fu">names</span>(data_ex), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
<pre><code>##    lanceur de2 de1
## 1      Luc   1   2
## 2      Luc   4   3
## 3     &lt;NA&gt;   2   4
## 4      Luc   3   1
## 5      Luc   1   2
## 6      Kim   4   3
## 7      Kim  NA   5
## 8      Kim   2   6
## 9      Kim   5   5
## 10     Kim   3   4</code></pre>
<p>Ainsi, la fonction <code>order</code> fournie la permutation selon l’ordre voulue, mais c’est l’opérateur <code>[</code> qui effectue la tâche de réordonner des lignes ou des colonnes.</p>
</div>
<div id="fonction-arrange-du-package-dplyr" class="section level3" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Fonction <code>arrange</code> du package <code>dplyr</code></h3>
<p>Si l’utilisation de la fonction <code>order</code> vous paraît peu conviviale, vous pouvez vous tourner vers la <a href="https://dplyr.tidyverse.org/reference/arrange.html">fonction <code>arrange</code> du package <code>dplyr</code></a> pour l’ordonnancement d’observations dans un data frame. Voici un exemple d’utilisation de cette fonction, produisant presque le même résultat que la commande suivante.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>data_ex[<span class="fu">order</span>(data_ex<span class="sc">$</span>de1, data_ex<span class="sc">$</span>lanceur), ]</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 4    1   3     Luc
## 1    2   1     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 2    3   4     Luc
## 10   4   3     Kim
## 3    4   2    &lt;NA&gt;
## 7    5  NA     Kim
## 9    5   5     Kim
## 8    6   2     Kim</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(data_ex, de1, lanceur)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    1   3     Luc
## 2    2   1     Luc
## 3    2   1     Luc
## 4    3   4     Kim
## 5    3   4     Luc
## 6    4   3     Kim
## 7    4   2    &lt;NA&gt;
## 8    5  NA     Kim
## 9    5   5     Kim
## 10   6   2     Kim</code></pre>
<p>La seule différence entre les deux sorties est les noms des lignes. La fonction <code>arrange</code> renomme les lignes 1 au nombre total de lignes.</p>
<p>Dans l’appel à la fonction <code>arrange</code>, il suffit de fournir d’abord le data frame à traiter, puis les noms des variables selon lesquelles définir l’ordre. Par défaut, ces variables sont prises dans le data frame fourni comme premier argument. Si elles proviennent bien de celui-ci, nul besoin de précéder leur nom de <code>nom_du_data_frame$</code> ou de l’encadrer de guillemets.</p>
<p>Avec <code>arrange</code>, pour demander un ordre décroissant par rapport à une certaine variable, il faut envelopper le nom de la variable par un appel à la <a href="https://dplyr.tidyverse.org/reference/desc.html">fonction <code>desc</code></a> comme dans cet exemple.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(data_ex, <span class="fu">desc</span>(de1), lanceur)</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    6   2     Kim
## 2    5  NA     Kim
## 3    5   5     Kim
## 4    4   3     Kim
## 5    4   2    &lt;NA&gt;
## 6    3   4     Kim
## 7    3   4     Luc
## 8    2   1     Luc
## 9    2   1     Luc
## 10   1   3     Luc</code></pre>
<p>La fonction <code>arrange</code> s’avère donc plus souple que <code>order</code>, qui applique le même type d’ordre (ascendant ou descendant) à toutes les variables. Toutefois, pour des variables numériques, le type d’ordre peut toujours être inversé en transformant la variable par elle-même multipliée par -1.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>data_ex[<span class="fu">order</span>(<span class="sc">-</span>data_ex<span class="sc">$</span>de1, data_ex<span class="sc">$</span>lanceur), ]</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 8    6   2     Kim
## 7    5  NA     Kim
## 9    5   5     Kim
## 10   4   3     Kim
## 3    4   2    &lt;NA&gt;
## 6    3   4     Kim
## 2    3   4     Luc
## 1    2   1     Luc
## 5    2   1     Luc
## 4    1   3     Luc</code></pre>
<p>Notons que la fonction <code>arrange</code> permet seulement d’ordonner les lignes d’un data frame (ou d’un <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#tibbles">tibble</a>), alors que la fonction <code>order</code> utilisée avec l’opérateur <code>[</code> permet en fait d’ordonner les éléments de n’importe quel type de structure de données et selon n’importe laquelle de ses dimensions.</p>
</div>
<div id="fonctions-setorder-et-setcolorder-du-package-data.table" class="section level3" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Fonctions <code>setorder</code> et <code>setcolorder</code> du package <code>data.table</code></h3>
<p>Les fonctions <a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html"><code>setorder</code></a> et <a href="https://rdatatable.gitlab.io/data.table/reference/setcolorder.html"><code>setcolorder</code></a> du package <code>data.table</code> permettent d’ordonner, respectivement, les lignes et les colonnes d’un data table. Tout comme l’opérateur <code>:=</code>, ces fonctions modifient un data table par référence (donc « sur place »), sans créer de copie.</p>
<p>Par exemple, reprenons la version data table du jeu de données <code>data_ex</code>.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>data_ex_dt</span></code></pre></div>
<pre><code>##     de1 de2 lanceur
##  1:   2   1     Luc
##  2:   3   4     Luc
##  3:   4   2    &lt;NA&gt;
##  4:   1   3     Luc
##  5:   2   1     Luc
##  6:   3   4     Kim
##  7:   5  NA     Kim
##  8:   6   2     Kim
##  9:   5   5     Kim
## 10:   4   3     Kim</code></pre>
<p>Réordonnons ses lignes en ordre décroissant de valeur de la variable <code>de1</code> et en ordre alphabétique ascendant de valeur de la variable <code>lanceur</code> en cas d’égalité. Un type d’ordre descendant pour une variable s’obtient en précédent son nom de l’opérateur <code>-</code> dans l’appel à la fonction <code>setorder</code>. Mis à part la façon de demander un ordre descendant qui diffère, la fonction <code>setorder</code> s’utilise comme la fonction <code>arrange</code> de <code>dplyr</code>.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(data_ex_dt, <span class="sc">-</span>de1, lanceur)</span></code></pre></div>
<p>Remarquons que cette commande ne retourne rien. Elle a toutefois eu un effet (que nous pourrions qualifier d’effet de bord). Elle a modifié le data table <code>data_ex_dt</code>.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>data_ex_dt</span></code></pre></div>
<pre><code>##     de1 de2 lanceur
##  1:   6   2     Kim
##  2:   5  NA     Kim
##  3:   5   5     Kim
##  4:   4   2    &lt;NA&gt;
##  5:   4   3     Kim
##  6:   3   4     Kim
##  7:   3   4     Luc
##  8:   2   1     Luc
##  9:   2   1     Luc
## 10:   1   3     Luc</code></pre>
<p>Pour changer l’ordre des variables d’un data table par référence, il suffit de fournir à la fonction <code>setcolorder</code> ce data table, puis un vecteur des noms de variables dans l’ordre souhaité.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(data_ex_dt,  <span class="fu">c</span>(<span class="st">&quot;lanceur&quot;</span>, <span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>))</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>data_ex_dt</span></code></pre></div>
<pre><code>##     lanceur de1 de2
##  1:     Kim   6   2
##  2:     Kim   5  NA
##  3:     Kim   5   5
##  4:    &lt;NA&gt;   4   2
##  5:     Kim   4   3
##  6:     Kim   3   4
##  7:     Luc   3   4
##  8:     Luc   2   1
##  9:     Luc   2   1
## 10:     Luc   1   3</code></pre>
</div>
</div>
<div id="changement-de-mise-en-forme-de-jeux-de-données" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Changement de mise en forme de jeux de données</h2>
<p>La mise en forme de jeux de données est définie ici, de façon générale, par le choix de positionnement des données dans un tableau de données.</p>
<p>Par exemple, en statistique, les variables sont habituellement positionnées en colonnes et les observations en lignes dans un tableau de données. Que faire avec un tableau de données dans lequel les variables sont en lignes et les observations en colonnes ? Il serait judicieux de transposer le tableau (inverser les lignes et les colonnes), afin de retomber sur une mise en forme plus standard.</p>
<p>Toutefois, l’expression mise en forme de jeux de données réfère le plus souvent en statistique à la distinction entre les mises en forme « large » et « longue », qui sont définies un peu plus bas.</p>
<div id="transposition-avec-la-fonction-t" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Transposition avec la fonction <code>t</code></h3>
<p>La <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/t.html">fonction <code>t</code></a> sert à transposer (inverser les lignes et les colonnes) une matrice ou un data frame.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>data_ex</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>data_ex_transpo <span class="ot">&lt;-</span> <span class="fu">t</span>(data_ex)</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>data_ex_transpo</span></code></pre></div>
<pre><code>##         [,1]  [,2]  [,3] [,4]  [,5]  [,6]  [,7]  [,8]  [,9]  [,10]
## de1     &quot;2&quot;   &quot;3&quot;   &quot;4&quot;  &quot;1&quot;   &quot;2&quot;   &quot;3&quot;   &quot;5&quot;   &quot;6&quot;   &quot;5&quot;   &quot;4&quot;  
## de2     &quot; 1&quot;  &quot; 4&quot;  &quot; 2&quot; &quot; 3&quot;  &quot; 1&quot;  &quot; 4&quot;  NA    &quot; 2&quot;  &quot; 5&quot;  &quot; 3&quot; 
## lanceur &quot;Luc&quot; &quot;Luc&quot; NA   &quot;Luc&quot; &quot;Luc&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot; &quot;Kim&quot;</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_ex_transpo)</span></code></pre></div>
<pre><code>##  chr [1:3, 1:10] &quot;2&quot; &quot; 1&quot; &quot;Luc&quot; &quot;3&quot; &quot; 4&quot; &quot;Luc&quot; &quot;4&quot; &quot; 2&quot; NA &quot;1&quot; &quot; 3&quot; &quot;Luc&quot; ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:3] &quot;de1&quot; &quot;de2&quot; &quot;lanceur&quot;
##   ..$ : NULL</code></pre>
<p>Cependant, la fonction <code>t</code> est en fait conçue pour effectuer des calculs d’algèbre linéaire et elle retourne toujours une matrice.</p>
</div>
<div id="comparaison-des-mises-en-forme-large-et-longue" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Comparaison des mises en forme large et longue</h3>
<p>Tout d’abord, introduisons un peu de terminologie informelle qui nous aidera à décrire les mises en forme.</p>
<ul>
<li>Individus (ou unités statistiques, ou sujets) :
<ul>
<li>unités sur lesquelles des mesures sont prises;</li>
<li>possèdent des identifiants.</li>
</ul></li>
<li>Variables :
<ul>
<li>ce qui est mesuré;</li>
<li>possèdent aussi des identifiants.</li>
</ul></li>
<li>Valeurs :
<ul>
<li>mesures obtenues;</li>
<li>chaque valeur est associée à un individu et une variable.</li>
</ul></li>
</ul>
<div id="mise-en-forme-large-en-anglais-wide" class="section level4" number="2.5.2.1">
<h4><span class="header-section-number">2.5.2.1</span> Mise en forme large (en anglais <em>wide</em>) :</h4>
<p></p>
<p>Lorsqu’un jeu de données comprend une seule ligne par individu et que les différentes variables mesurées se trouvent dans différentes colonnes, la mise en forme du jeu de données est dite « large ».</p>
<div id="exemple-de-notes-détudiants---mise-en-forme-large" class="section level5" number="2.5.2.1.1">
<h5><span class="header-section-number">2.5.2.1.1</span> Exemple de notes d’étudiants - Mise en forme large</h5>
<p></p>
<ul>
<li>Individus = étudiants (au nombre de 4),</li>
<li>Variables = notes pour deux travaux pratiques : <code>TP1</code> et <code>TP2</code></li>
</ul>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>notes_large <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">etudiant =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>), </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">TP1 =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">80</span>, <span class="dv">70</span>, <span class="dv">60</span>), </span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">TP2 =</span> <span class="fu">c</span>(<span class="dv">95</span>, <span class="dv">74</span>, <span class="dv">89</span>, <span class="dv">85</span>)</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>notes_large</span></code></pre></div>
<pre><code>##   etudiant TP1 TP2
## 1        a  90  95
## 2        b  80  74
## 3        c  70  89
## 4        d  60  85</code></pre>
</div>
</div>
<div id="mise-en-forme-longue-en-anglais-long" class="section level4" number="2.5.2.2">
<h4><span class="header-section-number">2.5.2.2</span> Mise en forme longue (en anglais <em>long</em>) :</h4>
<p></p>
<p>Si un jeu de données comporte plutôt plus d’une ligne par individu, sa mise en forme est dite « longue ».</p>
<div id="exemple-de-notes-détudiants---mise-en-forme-longue" class="section level5" number="2.5.2.2.1">
<h5><span class="header-section-number">2.5.2.2.1</span> Exemple de notes d’étudiants - Mise en forme longue</h5>
<p></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>notes_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">etudiant =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>),</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">note =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">80</span>, <span class="dv">70</span>, <span class="dv">60</span>, <span class="dv">95</span>, <span class="dv">74</span>, <span class="dv">89</span>, <span class="dv">85</span>),</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">evaluation =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;TP1&quot;</span>, <span class="st">&quot;TP2&quot;</span>), <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>notes_long</span></code></pre></div>
<pre><code>##   etudiant note evaluation
## 1        a   90        TP1
## 2        b   80        TP1
## 3        c   70        TP1
## 4        d   60        TP1
## 5        a   95        TP2
## 6        b   74        TP2
## 7        c   89        TP2
## 8        d   85        TP2</code></pre>
<p>Le data frame <code>notes_long</code> contient exactement les mêmes données que celles dans le data frame <code>notes_large</code>, mais disposées différemment. Dans <code>notes_long</code>, il y a deux lignes par individu. Le tableau de mise en forme longue contient plus de lignes, donc est plus long, que le tableau de mise en forme large, d’où les qualificatifs « large » et « longue » pour les mises en forme.</p>
<p>Dans un jeu de données avec une mise en forme longue, les mesures pour plus d’une variable sont combinées dans une même colonne. Cependant, il doit aussi nécessairement y avoir une ou des colonnes servant à identifier à quelle variable est associée chaque valeur (colonne <code>evaluation</code> dans l’exemple).</p>
<p>Lors d’une analyse statistique de données stockées sous une mise en forme longue, l’analyste doit être vigilant. Il est important d’être conscient que certaines lignes concernent les mêmes individus, donc qu’il s’agit de <em>mesures répétées</em> sur les mêmes individus et non d’observations indépendantes.</p>
</div>
</div>
<div id="mise-en-forme-intermédiaire" class="section level4" number="2.5.2.3">
<h4><span class="header-section-number">2.5.2.3</span> Mise en forme intermédiaire :</h4>
<p></p>
<p>Il peut arriver qu’un jeu de données ait une mise en forme mi-large, mi-longue. Voici un exemple pour illustrer cette mise en forme intermédiaire.</p>
<div id="exemple-de-mesures-sur-des-plants" class="section level5" number="2.5.2.3.1">
<h5><span class="header-section-number">2.5.2.3.1</span> Exemple de mesures sur des plants</h5>
<p></p>
<ul>
<li>Individus = plants (au nombre de 3),</li>
<li>Variables = <code>Hauteur_Temps1</code>, <code>Hauteur_Temps2</code>, <code>Diametre_Temps1</code>, <code>Diametre_Temps2</code></li>
</ul>
</div>
<div id="mise-en-forme-large-pure-une-ligne-par-individu-une-colonne-par-variable" class="section level5" number="2.5.2.3.2">
<h5><span class="header-section-number">2.5.2.3.2</span> Mise en forme large pure : une ligne par individu, une colonne par variable</h5>
<p></p>
<p>Dimension de la sous-matrice contenant les valeurs : 3 x 4</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>plants_large <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Plant =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hauteur_Temps1 =</span> <span class="fu">c</span>(<span class="dv">67</span>, <span class="dv">59</span>, <span class="dv">62</span>),</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hauteur_Temps2 =</span> <span class="fu">c</span>(<span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">66</span>),</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Diametre_Temps1 =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">13</span>),</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Diametre_Temps2 =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">14</span>),</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>plants_large</span></code></pre></div>
<pre><code>##   Plant Hauteur_Temps1 Hauteur_Temps2 Diametre_Temps1 Diametre_Temps2
## 1     a             67             69              15              15
## 2     b             59             65              16              17
## 3     c             62             66              13              14</code></pre>
</div>
<div id="mise-en-forme-intermédiaire-plus-dune-ligne-par-individu-mais-valeurs-réparties-dans-plus-dune-colonne" class="section level5" number="2.5.2.3.3">
<h5><span class="header-section-number">2.5.2.3.3</span> Mise en forme intermédiaire : plus d’une ligne par individu, mais valeurs réparties dans plus d’une colonne</h5>
<p></p>
<p>Dimension de la sous-matrice contenant les valeurs : 6 x 2</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>plants_inter <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Plant =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Temps =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hauteur =</span> <span class="fu">c</span>(<span class="dv">67</span>, <span class="dv">59</span>, <span class="dv">62</span>, <span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">66</span>),</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Diametre =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">14</span>),</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>plants_inter</span></code></pre></div>
<pre><code>##   Plant Temps Hauteur Diametre
## 1     a     1      67       15
## 2     b     1      59       16
## 3     c     1      62       13
## 4     a     2      69       15
## 5     b     2      65       17
## 6     c     2      66       14</code></pre>
</div>
<div id="mise-en-forme-longue-pure-toutes-les-valeurs-sont-empilées-dans-une-seule-colonne" class="section level5" number="2.5.2.3.4">
<h5><span class="header-section-number">2.5.2.3.4</span> Mise en forme longue pure : toutes les valeurs sont empilées dans une seule colonne</h5>
<p></p>
<p>Dimension de la sous-matrice contenant les valeurs : 12 x 1</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>plants_long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Plant =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">times =</span> <span class="dv">4</span>),</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Temps =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">3</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Hauteur&quot;</span>, <span class="st">&quot;Diametre&quot;</span>), <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valeur =</span> <span class="fu">c</span>(<span class="dv">67</span>, <span class="dv">59</span>, <span class="dv">62</span>, <span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">66</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">14</span>),</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>plants_long</span></code></pre></div>
<pre><code>##    Plant Temps Variable Valeur
## 1      a     1  Hauteur     67
## 2      b     1  Hauteur     59
## 3      c     1  Hauteur     62
## 4      a     2  Hauteur     69
## 5      b     2  Hauteur     65
## 6      c     2  Hauteur     66
## 7      a     1 Diametre     15
## 8      b     1 Diametre     16
## 9      c     1 Diametre     13
## 10     a     2 Diametre     15
## 11     b     2 Diametre     17
## 12     c     2 Diametre     14</code></pre>
<p>ou encore</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>plants_long_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Plant =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">times =</span> <span class="dv">4</span>),</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">rep</span>(</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;Hauteur_Temps1&quot;</span>, <span class="st">&quot;Hauteur_Temps2&quot;</span>, <span class="st">&quot;Diametre_Temps1&quot;</span>, <span class="st">&quot;Diametre_Temps2&quot;</span>), </span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">each =</span> <span class="dv">3</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valeur =</span> <span class="fu">c</span>(<span class="dv">67</span>, <span class="dv">59</span>, <span class="dv">62</span>, <span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">66</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">14</span>),</span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>plants_long_2</span></code></pre></div>
<pre><code>##    Plant        Variable Valeur
## 1      a  Hauteur_Temps1     67
## 2      b  Hauteur_Temps1     59
## 3      c  Hauteur_Temps1     62
## 4      a  Hauteur_Temps2     69
## 5      b  Hauteur_Temps2     65
## 6      c  Hauteur_Temps2     66
## 7      a Diametre_Temps1     15
## 8      b Diametre_Temps1     16
## 9      c Diametre_Temps1     13
## 10     a Diametre_Temps2     15
## 11     b Diametre_Temps2     17
## 12     c Diametre_Temps2     14</code></pre>
</div>
</div>
<div id="utilisation-des-deux-mises-en-forme" class="section level4" number="2.5.2.4">
<h4><span class="header-section-number">2.5.2.4</span> Utilisation des deux mises en forme</h4>
<p></p>
<p>Certaines fonctions R requièrent un type particulier de mise en forme du jeu de données.</p>
<p>Dans l’exemple des notes d’étudiants, nous pourrions vouloir comparer les notes des deux travaux. Étant donné que nous sommes en présence de données prises sur les mêmes individus (qualifiées en statistique de <em>mesures répétées</em> ou encore de <em>données pairées</em> dans le cas particulier de deux variables), un test approprié à réaliser serait un test de comparaison de moyennes pour données pairées. La <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/t.test.html">fonction <code>t.test</code></a> réalise ce type de test. Elle accepte les jeux de données de mise en forme large,</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(notes_large<span class="sc">$</span>TP1, notes_large<span class="sc">$</span>TP2, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  notes_large$TP1 and notes_large$TP2
## t = -1.54, df = 3, p-value = 0.2212
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -32.96547  11.46547
## sample estimates:
## mean of the differences 
##                  -10.75</code></pre>
<p>ou de mise en forme longue (qui permet l’utilisation d’une formule R).</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(note <span class="sc">~</span> evaluation, <span class="at">data =</span> notes_long, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  note by evaluation
## t = -1.54, df = 3, p-value = 0.2212
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -32.96547  11.46547
## sample estimates:
## mean of the differences 
##                  -10.75</code></pre>
<p>Nous pourrions aussi ajuster un modèle linéaire mixte pour réaliser un test équivalent. La <a href="https://stat.ethz.ch/R-manual/R-devel/library/nlme/html/lme.html">fonction <code>lme</code> du package <code>nlme</code></a> ajuste des modèles linéaires mixtes. Elle accepte cependant seulement des jeux de données de mise en forme longue.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>mixed <span class="ot">&lt;-</span> <span class="fu">lme</span>(<span class="at">fixed =</span> note <span class="sc">~</span> evaluation, <span class="at">data =</span> notes_long, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> etudiant)</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mixed)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: notes_long 
##        AIC     BIC    logLik
##   56.51876 55.6858 -24.25938
## 
## Random effects:
##  Formula: ~1 | etudiant
##         (Intercept) Residual
## StdDev:    5.000001 9.872098
## 
## Fixed effects:  note ~ evaluation 
##               Value Std.Error DF   t-value p-value
## (Intercept)   75.00  5.533045  3 13.554924  0.0009
## evaluationTP2 10.75  6.980628  3  1.539976  0.2212
##  Correlation: 
##               (Intr)
## evaluationTP2 -0.631
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -1.2489496 -0.6258934  0.2768885  0.5459932  1.1029740 
## 
## Number of Observations: 8
## Number of Groups: 4</code></pre>
<p>Nous avons utilisé ici un modèle statistique puissant pour réaliser en fait un test simple. Le test sur le terme <code>evaluationTP2</code> dans le modèle linéaire mixte revient au test de comparaison de moyennes pour données pairées réalisé avec la fonction <code>t.test</code>. Nous pouvons constater que le seuil observé des deux tests est le même, soit 0.2212.</p>
<p>Le but de cet exemple était de montrer qu’il est utile en R de savoir convertir un jeu de données d’une mise à forme à l’autre puisque certaines fonctions exigent une mise en forme spécifique.</p>
</div>
</div>
<div id="fonctions-stack-et-unstack" class="section level3" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Fonctions <code>stack</code> et <code>unstack</code></h3>
<p>Revenons maintenant au jeu de données <code>data_ex</code>. Celui-ci est sous une mise en forme large, car il contient une seule ligne par individu. Dans ce jeu de données, un individu est un lancer de dés.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>data_ex</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>Il est possible de faire passer ce jeu de données à une mise en forme longue avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/stack.html">fonction <code>stack</code></a> comme suit.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>data_ex_long <span class="ot">&lt;-</span> <span class="fu">stack</span>(data_ex)</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>data_ex_long</span></code></pre></div>
<pre><code>##    values     ind
## 1       2     de1
## 2       3     de1
## 3       4     de1
## 4       1     de1
## 5       2     de1
## 6       3     de1
## 7       5     de1
## 8       6     de1
## 9       5     de1
## 10      4     de1
## 11      1     de2
## 12      4     de2
## 13      2     de2
## 14      3     de2
## 15      1     de2
## 16      4     de2
## 17   &lt;NA&gt;     de2
## 18      2     de2
## 19      5     de2
## 20      3     de2
## 21    Luc lanceur
## 22    Luc lanceur
## 23   &lt;NA&gt; lanceur
## 24    Luc lanceur
## 25    Luc lanceur
## 26    Kim lanceur
## 27    Kim lanceur
## 28    Kim lanceur
## 29    Kim lanceur
## 30    Kim lanceur</code></pre>
<p>Cette fonction n’est pas très puissante. Elle n’a pas su traiter la colonne <code>lanceur</code> et l’a laissé tomber.</p>
<p>Nous pourrions réaliser la transformation inverse avec la <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/stack.html">fonction <code>unstack</code></a>, pour revenir à la mise en forme originale.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>data_ex_large <span class="ot">&lt;-</span> <span class="fu">unstack</span>(data_ex_long)</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>data_ex_large</span></code></pre></div>
<pre><code>##    de1  de2 lanceur
## 1    2    1     Luc
## 2    3    4     Luc
## 3    4    2    &lt;NA&gt;
## 4    1    3     Luc
## 5    2    1     Luc
## 6    3    4     Kim
## 7    5 &lt;NA&gt;     Kim
## 8    6    2     Kim
## 9    5    5     Kim
## 10   4    3     Kim</code></pre>
<p>Les noms <code>stack</code> et <code>unstack</code> viennent du fait que pour passer d’une mise en forme large vers une mise en forme longue, des valeurs doivent être empilées (en anglais <em>stacked</em>) dans une même colonne, alors que pour réaliser la transformation inverse elles doivent être « désempilées » (en anglais <em>unstacked</em>).</p>
<p>Voyons maintenant une autre fonction qui nous permettra de réaliser les mêmes transformations, sans mettre de côté la variable <code>lanceur</code>.</p>
</div>
<div id="fonction-reshape" class="section level3" number="2.5.4">
<h3><span class="header-section-number">2.5.4</span> Fonction <code>reshape</code></h3>
<p>Le package <code>stats</code>, chargé en R par défaut, comprend une <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/reshape.html">fonction nommée <code>reshape</code></a> dont l’utilité est de faire passer un jeu de donnée d’une mise en forme large vers une mise en forme longue, et aussi de réaliser la transformation inverse, d’une mise en forme longue vers une mise en forme large. Cette fonction est puissante, mais un peu difficile à utiliser, il faut l’avouer. Il est facile de se perdre dans ses nombreux arguments.</p>
<div id="exemple-de-transformation-vers-une-mise-en-forme-longue" class="section level4" number="2.5.4.1">
<h4><span class="header-section-number">2.5.4.1</span> Exemple de transformation vers une mise en forme longue :</h4>
<p></p>
<p>Pour faire passer le data frame <code>data_ex</code> vers une mise en forme longue avec <code>reshape</code>, nous pouvons procéder comme suit.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>data_ex_long_2 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex, </span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>, </span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>),</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;resultat&quot;</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>data_ex_long_2</span></code></pre></div>
<pre><code>##      lanceur time resultat id
## 1.1      Luc    1        2  1
## 2.1      Luc    1        3  2
## 3.1     &lt;NA&gt;    1        4  3
## 4.1      Luc    1        1  4
## 5.1      Luc    1        2  5
## 6.1      Kim    1        3  6
## 7.1      Kim    1        5  7
## 8.1      Kim    1        6  8
## 9.1      Kim    1        5  9
## 10.1     Kim    1        4 10
## 1.2      Luc    2        1  1
## 2.2      Luc    2        4  2
## 3.2     &lt;NA&gt;    2        2  3
## 4.2      Luc    2        3  4
## 5.2      Luc    2        1  5
## 6.2      Kim    2        4  6
## 7.2      Kim    2       NA  7
## 8.2      Kim    2        2  8
## 9.2      Kim    2        5  9
## 10.2     Kim    2        3 10</code></pre>
<p>Il faut toujours fournir à la fonction <code>reshape</code> les arguments :</p>
<ul>
<li><code>data</code> : le data frame dont la mise en forme est à transformer;</li>
<li><code>direction</code> : la direction de la transformation, <code>"long"</code> pour une transformation vers une mise en forme longue, <code>"wide"</code> pour une transformation vers une mise en forme large.</li>
</ul>
<p>Lors d’une transformation vers une mise en forme longue, il faut aussi spécifier l’argument :</p>
<ul>
<li><code>varying</code> : les noms ou les indices des colonnes dans le jeu de données d’origine (<code>data</code>) sous la mise en forme large contenant les valeurs à combiner dans des colonnes uniques sous la mise en forme longue.</li>
</ul>
<p>La fonction <code>reshape</code> va alors tenter de deviner le ou les noms à donner à cette ou ces nouvelles colonnes, mais il est préférable de lui spécifier ce ou ces noms avec l’argument :</p>
<ul>
<li><code>v.names</code> : nom(s) de la ou des colonnes dans la mise en forme longue où sont empilées les valeurs provenant de plusieurs colonnes dans la mise en forme large.</li>
</ul>
<p>Par défaut, <code>reshape</code> a nommé <code>time</code> la colonne contenant les identifiants des variables dont les valeurs ont été empilées. Aussi, <code>reshape</code> a utilisé comme identifiants dans cette colonne les entiers allant de 1 jusqu’au nombre de variables spécifiées dans <code>varying</code>. Il est possible de contrôler cette colonne avec les arguments :</p>
<ul>
<li><code>timevar</code> : nom de la colonne dans la mise en forme longue contenant, pour chaque ligne, l’identifiant de la variable de laquelle la valeur qui se trouve dans la colonne identifiée par <code>v.names</code> est une mesure (ou de laquelle les valeurs qui se trouvent dans les colonnes identifiées par <code>v.names</code> sont des mesures).</li>
<li><code>times</code> : les valeurs d’identifiants à utiliser dans la colonne spécifiée par <code>timevar</code>.</li>
</ul>
<p>Les noms de ces arguments contiennent le mot <code>time</code> en référence à un cas classique de données pour lesquelles nous sommes susceptibles de vouloir modifier la mise en forme : des mesures répétées dans le temps.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>data_ex_long_2 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex,</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>),</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;resultat&quot;</span>,</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;de&quot;</span>,</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>)</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a>data_ex_long_2</span></code></pre></div>
<pre><code>##        lanceur  de resultat id
## 1.de1      Luc de1        2  1
## 2.de1      Luc de1        3  2
## 3.de1     &lt;NA&gt; de1        4  3
## 4.de1      Luc de1        1  4
## 5.de1      Luc de1        2  5
## 6.de1      Kim de1        3  6
## 7.de1      Kim de1        5  7
## 8.de1      Kim de1        6  8
## 9.de1      Kim de1        5  9
## 10.de1     Kim de1        4 10
## 1.de2      Luc de2        1  1
## 2.de2      Luc de2        4  2
## 3.de2     &lt;NA&gt; de2        2  3
## 4.de2      Luc de2        3  4
## 5.de2      Luc de2        1  5
## 6.de2      Kim de2        4  6
## 7.de2      Kim de2       NA  7
## 8.de2      Kim de2        2  8
## 9.de2      Kim de2        5  9
## 10.de2     Kim de2        3 10</code></pre>
<p>Sous une mise en forme longue, <code>reshape</code> inclut aussi toujours au moins une colonne pour contenir un identifiant des individus. Il nomme par défaut cette colonne <code>id</code> et utilise comme identifiants les entiers allant de 1 jusqu’au nombre de lignes dans le jeu de données d’origine (<code>data</code>) sous la mise en forme large. Pour contrôler cette colonne, il faut utiliser les arguments :</p>
<ul>
<li><code>idvar</code> : nom(s) de la ou des colonnes pour identifier les individus;</li>
<li><code>ids</code> : les valeurs d’identifiants à utiliser dans la ou les colonnes spécifiées par <code>idvar</code>.</li>
</ul>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>data_ex_long_2 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex,</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>),</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;resultat&quot;</span>,</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;de&quot;</span>,</span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>),</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;IDlancer&quot;</span>,</span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids =</span> <span class="fu">paste0</span>(<span class="st">&quot;l&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a>data_ex_long_2</span></code></pre></div>
<pre><code>##         lanceur  de resultat IDlancer
## l1.de1      Luc de1        2       l1
## l2.de1      Luc de1        3       l2
## l3.de1     &lt;NA&gt; de1        4       l3
## l4.de1      Luc de1        1       l4
## l5.de1      Luc de1        2       l5
## l6.de1      Kim de1        3       l6
## l7.de1      Kim de1        5       l7
## l8.de1      Kim de1        6       l8
## l9.de1      Kim de1        5       l9
## l10.de1     Kim de1        4      l10
## l1.de2      Luc de2        1       l1
## l2.de2      Luc de2        4       l2
## l3.de2     &lt;NA&gt; de2        2       l3
## l4.de2      Luc de2        3       l4
## l5.de2      Luc de2        1       l5
## l6.de2      Kim de2        4       l6
## l7.de2      Kim de2       NA       l7
## l8.de2      Kim de2        2       l8
## l9.de2      Kim de2        5       l9
## l10.de2     Kim de2        3      l10</code></pre>
<p>Dans le jeu de données de mise en forme longue obtenu en sortie de <code>reshape</code>, les données pour les variables (colonnes) ne contenant pas de mesures répétées ont simplement été recopiées autant de fois que nécessaire. Il serait possible de laisser tomber ces variables grâce à l’argument <code>drop</code>. Il serait aussi possible de contrôler les noms des lignes du data frame obtenu avec l’argument <code>new.row.names</code>.</p>
</div>
<div id="exemple-de-transformation-vers-une-mise-en-forme-large" class="section level4" number="2.5.4.2">
<h4><span class="header-section-number">2.5.4.2</span> Exemple de transformation vers une mise en forme large :</h4>
<p></p>
<p>Lorsque nous avons obtenu un jeu de données avec la fonction <code>reshape</code>, il est toujours possible de retourner à la mise en forme d’origine simplement avec la commande</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(data_ex_long_2)</span></code></pre></div>
<pre><code>##         lanceur IDlancer de1 de2
## l1.de1      Luc       l1   2   1
## l2.de1      Luc       l2   3   4
## l3.de1     &lt;NA&gt;       l3   4   2
## l4.de1      Luc       l4   1   3
## l5.de1      Luc       l5   2   1
## l6.de1      Kim       l6   3   4
## l7.de1      Kim       l7   5  NA
## l8.de1      Kim       l8   6   2
## l9.de1      Kim       l9   5   5
## l10.de1     Kim      l10   4   3</code></pre>
<p>en raison d’un attribut inséré par <code>reshape</code> dans sa sortie.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_ex_long_2)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    20 obs. of  4 variables:
##  $ lanceur : chr  &quot;Luc&quot; &quot;Luc&quot; NA &quot;Luc&quot; ...
##  $ de      : chr  &quot;de1&quot; &quot;de1&quot; &quot;de1&quot; &quot;de1&quot; ...
##  $ resultat: num  2 3 4 1 2 3 5 6 5 4 ...
##  $ IDlancer: chr  &quot;l1&quot; &quot;l2&quot; &quot;l3&quot; &quot;l4&quot; ...
##  - attr(*, &quot;reshapeLong&quot;)=List of 4
##   ..$ varying:List of 1
##   .. ..$ resultat: chr [1:2] &quot;de1&quot; &quot;de2&quot;
##   .. ..- attr(*, &quot;v.names&quot;)= chr &quot;resultat&quot;
##   .. ..- attr(*, &quot;times&quot;)= chr [1:2] &quot;de1&quot; &quot;de2&quot;
##   ..$ v.names: chr &quot;resultat&quot;
##   ..$ idvar  : chr &quot;IDlancer&quot;
##   ..$ timevar: chr &quot;de&quot;</code></pre>
<p>Mais supposons que nous n’avons pas créé <code>data_ex_long_2</code> avec la fonction <code>reshape</code> et que nous voulons transformer ce jeu de données vers une mise en forme large. Afin de réellement simuler une telle situation, nous allons effacer de <code>data_ex_long_2</code> son attribut nommé <code>reshapeLong</code> comme suit.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data_ex_long_2, <span class="st">&quot;reshapeLong&quot;</span>) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_ex_long_2)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    20 obs. of  4 variables:
##  $ lanceur : chr  &quot;Luc&quot; &quot;Luc&quot; NA &quot;Luc&quot; ...
##  $ de      : chr  &quot;de1&quot; &quot;de1&quot; &quot;de1&quot; &quot;de1&quot; ...
##  $ resultat: num  2 3 4 1 2 3 5 6 5 4 ...
##  $ IDlancer: chr  &quot;l1&quot; &quot;l2&quot; &quot;l3&quot; &quot;l4&quot; ...</code></pre>
<p>Nous pourrions procéder ainsi pour effectuer la transformation de mise en forme.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>data_ex_large2 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex_long_2,</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;de&quot;</span>,</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;IDlancer&quot;</span></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>data_ex_large2</span></code></pre></div>
<pre><code>##         IDlancer lanceur.de1 resultat.de1 lanceur.de2 resultat.de2
## l1.de1        l1         Luc            2         Luc            1
## l2.de1        l2         Luc            3         Luc            4
## l3.de1        l3        &lt;NA&gt;            4        &lt;NA&gt;            2
## l4.de1        l4         Luc            1         Luc            3
## l5.de1        l5         Luc            2         Luc            1
## l6.de1        l6         Kim            3         Kim            4
## l7.de1        l7         Kim            5         Kim           NA
## l8.de1        l8         Kim            6         Kim            2
## l9.de1        l9         Kim            5         Kim            5
## l10.de1      l10         Kim            4         Kim            3</code></pre>
<p>Les seuls arguments obligatoires pour réaliser cette transformation vers une mise en forme large sont <code>data</code>, <code>direction</code>, <code>timevar</code> et <code>idvar</code>, dont les descriptions ont été fournies ci-dessus. Cependant, <code>reshape</code> a par défaut considéré que toutes les variables autres que celles identifiées avec <code>timevar</code> et <code>idvar</code> contiennent des mesures répétées. Nous nous retrouvons donc maintenant avec deux colonnes identiques contenant le nom du lanceur. Pour spécifier à <code>reshape</code> la ou les colonnes pour lesquelles les valeurs doivent être réparties en plusieurs colonnes, il faut aussi spécifier l’argument <code>v.names</code>.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>data_ex_large2 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>  data_ex_long_2,</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;de&quot;</span>,</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;IDlancer&quot;</span>,</span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;resultat&quot;</span></span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a>data_ex_large2</span></code></pre></div>
<pre><code>##         lanceur IDlancer resultat.de1 resultat.de2
## l1.de1      Luc       l1            2            1
## l2.de1      Luc       l2            3            4
## l3.de1     &lt;NA&gt;       l3            4            2
## l4.de1      Luc       l4            1            3
## l5.de1      Luc       l5            2            1
## l6.de1      Kim       l6            3            4
## l7.de1      Kim       l7            5           NA
## l8.de1      Kim       l8            6            2
## l9.de1      Kim       l9            5            5
## l10.de1     Kim      l10            4            3</code></pre>
<p>Et voilà!</p>
<p>Afin de reconstruire un data frame vraiment identique à <code>data_ex</code>,</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>data_ex</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
<p>il suffirait de retirer la colonne <code>IDlancer</code>, renommer les colonnes contenant les résultats des lancers de dés, réordonner les colonnes et renommer les lignes.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>data_ex_large2<span class="sc">$</span>IDlancer <span class="ot">&lt;-</span> <span class="cn">NULL</span>                                 <span class="co"># retirer une colonne</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_ex_large2)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>)                <span class="co"># renommer des colonnes</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>data_ex_large2 <span class="ot">&lt;-</span> data_ex_large2[, <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>, <span class="st">&quot;lanceur&quot;</span>)]  <span class="co"># réordonner les colonnes</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data_ex_large2) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>                                <span class="co"># renommer les lignes</span></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>data_ex_large2</span></code></pre></div>
<pre><code>##    de1 de2 lanceur
## 1    2   1     Luc
## 2    3   4     Luc
## 3    4   2    &lt;NA&gt;
## 4    1   3     Luc
## 5    2   1     Luc
## 6    3   4     Kim
## 7    5  NA     Kim
## 8    6   2     Kim
## 9    5   5     Kim
## 10   4   3     Kim</code></pre>
</div>
<div id="récapitulatif-concernant-les-arguments-de-reshape" class="section level4" number="2.5.4.3">
<h4><span class="header-section-number">2.5.4.3</span> Récapitulatif concernant les arguments de <code>reshape</code> :</h4>
<p>En résumé, les arguments de <code>reshape</code> sont les suivants :</p>
<ul>
<li>En lien avec le contexte :
<ul>
<li><code>data</code> : data frame à remettre en forme;</li>
<li><code>direction</code> : direction de la remise en forme (<code>"wide"</code> ou <code>"long"</code>).</li>
</ul></li>
<li>En lien avec les individus :
<ul>
<li><code>idvar</code> : nom(s) colonne(s) contenant les identifiants des individus;</li>
<li><code>ids</code> : identifiants des individus.</li>
</ul></li>
<li>En lien avec les variables :
<ul>
<li><code>timevar</code> : nom colonne contenant les identifiants des variables;</li>
<li><code>times</code> : identifiants des variables.</li>
</ul></li>
<li>En lien avec les valeurs :
<ul>
<li><code>v.names</code> : nom(s) colonne(s) contenant les valeurs empilées dans le mise en forme longue ou intermédiaire;</li>
<li><code>varying</code> : noms colonnes contenant les valeurs dans le mise en forme large ou intermédiaire.</li>
</ul></li>
</ul>
</div>
</div>
<div id="fonctions-pivot_longer-et-pivot_wider-du-package-tidyr" class="section level3" number="2.5.5">
<h3><span class="header-section-number">2.5.5</span> Fonctions <code>pivot_longer</code> et <code>pivot_wider</code> du package <code>tidyr</code></h3>
<p>Le package <code>tidyr</code> offre les fonctions suivantes, permettant d’effectuer des transformations de mise en forme :</p>
<ul>
<li>mise en forme large vers longue : <a href="https://tidyr.tidyverse.org/dev/reference/pivot_longer.html"><code>pivot_longer</code></a>,</li>
<li>mise en forme longue vers large : <a href="https://tidyr.tidyverse.org/dev/reference/pivot_wider.html"><code>pivot_wider</code></a>.</li>
</ul>
<p>Ces fonctions remplacent les fonctions <code>gather</code> et <code>spread</code> <a href="https://www.tidyverse.org/blog/2019/09/tidyr-1-0-0/">depuis septembre 2019</a>. Illustrons l’utilisation des <a href="https://tidyr.tidyverse.org/dev/articles/pivot.html">fonctions <code>pivot_longer</code> et <code>pivot_wider</code></a>.</p>
<div id="exemple-de-transformation-vers-une-mise-en-forme-longue-1" class="section level4" number="2.5.5.1">
<h4><span class="header-section-number">2.5.5.1</span> Exemple de transformation vers une mise en forme longue :</h4>
<p></p>
<p>Voici une commande pour transformer le data frame <code>data_ex</code> de sa mise en forme d’origine, large, vers une mise en forme longue avec la fonction <code>pivot_longer</code>.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>data_ex_long_3 <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex, </span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(de1, de2), </span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;de&quot;</span>, </span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">&quot;resultat&quot;</span></span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>data_ex_long_3</span></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    lanceur de    resultat
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
##  1 Luc     de1          2
##  2 Luc     de2          1
##  3 Luc     de1          3
##  4 Luc     de2          4
##  5 &lt;NA&gt;    de1          4
##  6 &lt;NA&gt;    de2          2
##  7 Luc     de1          1
##  8 Luc     de2          3
##  9 Luc     de1          2
## 10 Luc     de2          1
## 11 Kim     de1          3
## 12 Kim     de2          4
## 13 Kim     de1          5
## 14 Kim     de2         NA
## 15 Kim     de1          6
## 16 Kim     de2          2
## 17 Kim     de1          5
## 18 Kim     de2          5
## 19 Kim     de1          4
## 20 Kim     de2          3</code></pre>
<p>Il faut fournir à <code>pivot_longer</code> les arguments :</p>
<ul>
<li><code>data</code> : le data frame (ou tibble) dont la mise en forme est à transformer;</li>
<li><code>cols</code> : les noms des colonnes dans le jeu de données d’origine (<code>data</code>) sous la mise en forme large contenant les données à empiler dans une seule colonne sous la mise en forme longue.</li>
</ul>
<p>Pour rendre le résultat plus facilement interprétable, il est aussi recommandé de fournir une valeur aux arguments suivants :</p>
<ul>
<li><code>names_to</code> : le nom de la colonne dans la mise en forme longue servant à identifier les variables dont les valeurs dans la nouvelle colonne de valeurs empilées sont des mesures;</li>
<li><code>values_to</code> : le nom de la colonne dans la mise en forme longue où seront empilées les valeurs provenant de plusieurs colonnes sous la mise en forme large.</li>
</ul>
<p>Remarquons que la fonction <code>pivot_longer</code> retourne un <a href="https://stt4230.rbind.io/manipulation_donnees/structures_r/#tibbles">tibble</a> et n’empile pas les valeurs dans le même ordre que <code>reshape</code>. De plus, <code>pivot_longer</code> n’ajoute pas une colonne pour identifier les individus comme le fait la fonction <code>reshape</code>. Il aurait fallu que le jeu de données d’origine contienne déjà une colonne avec ces identifiants. Dans <code>data_ex</code>, ce sont plutôt les noms de lignes qui identifient en quelque sorte les individus.</p>
</div>
<div id="exemple-de-transformation-vers-une-mise-en-forme-large-1" class="section level4" number="2.5.5.2">
<h4><span class="header-section-number">2.5.5.2</span> Exemple de transformation vers une mise en forme large :</h4>
<p></p>
<p>Afin d’effectuer une transformation d’une mise en forme longue vers une mise en forme large avec la fonction <code>pivot_wider</code> de <code>tidyr</code>, le jeu de données fourni en entrée à la fonction doit contenir une colonne pour identifier les individus. Voici donc un exemple d’utilisation de la fonction <code>pivot_wider</code>, réalisé en utilisant comme jeu de données d’origine <code>data_ex_long_2</code>.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>data_ex_large_3 <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex_long_2,</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> de, </span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> resultat</span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>data_ex_large_3</span></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##    lanceur IDlancer   de1   de2
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 Luc     l1           2     1
##  2 Luc     l2           3     4
##  3 &lt;NA&gt;    l3           4     2
##  4 Luc     l4           1     3
##  5 Luc     l5           2     1
##  6 Kim     l6           3     4
##  7 Kim     l7           5    NA
##  8 Kim     l8           6     2
##  9 Kim     l9           5     5
## 10 Kim     l10          4     3</code></pre>
<p>La fonction a réussi à réaliser la tâche souhaitée en fournissant seulement des valeurs aux arguments <code>data</code>, <code>names_from</code> et <code>values_from</code>, définis comme suit :</p>
<ul>
<li><code>data</code> : le data frame (ou tibble) dont la mise en forme est à transformer;</li>
<li><code>names_from</code> : le nom de la colonne dans la mise en forme longue contenant les identifiants des variables desquelles les valeurs empilées sont des mesures;</li>
<li><code>values_from</code> : le nom de la ou des colonnes dans la mise en forme longue où sont empilées les valeurs qui doivent maintenant être réparties dans plusieurs colonnes.</li>
</ul>
<p>Les références proposent de bonnes sources d’information pour en apprendre davantage à propos des fonctions <code>pivot_longer</code> et <code>pivot_wider</code>.</p>
</div>
</div>
<div id="fonctions-melt-et-dcast-du-package-data.table" class="section level3" number="2.5.6">
<h3><span class="header-section-number">2.5.6</span> Fonctions <code>melt</code> et <code>dcast</code> du package <code>data.table</code></h3>
<p>Le package <code>data.table</code> contient les fonctions suivantes, permettant d’effectuer des transformations de mise en forme :</p>
<ul>
<li>mise en forme large vers longue : <a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html"><code>melt</code></a>,</li>
<li>mise en forme longue vers large : <a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html"><code>dcast</code></a>.</li>
</ul>
<p>Ces fonctions sont en fait des extensions aux data tables des <a href="https://cran.r-project.org/web/packages/reshape2/index.html">fonctions portant les mêmes noms dans le package <code>reshape2</code></a>, qui n’est maintenant plus mis à jour. Illustrons l’utilisation des <a href="https://rdatatable.gitlab.io/data.table/articles/datatable-reshape.html">fonctions <code>melt</code> et <code>dcast</code></a>.</p>
<div id="exemple-de-transformation-vers-une-mise-en-forme-longue-2" class="section level4" number="2.5.6.1">
<h4><span class="header-section-number">2.5.6.1</span> Exemple de transformation vers une mise en forme longue :</h4>
<p></p>
<p>Voici une commande pour transformer le data table <code>data_ex_dt</code> de sa mise en forme d’origine, large, vers une mise en forme longue avec la fonction <code>melt</code> du package <code>data.table</code>.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>data_ex_long_4 <span class="ot">&lt;-</span> <span class="fu">melt</span>(</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex_dt, </span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;de1&quot;</span>, <span class="st">&quot;de2&quot;</span>), </span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable.name =</span> <span class="st">&quot;de&quot;</span>, </span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name =</span> <span class="st">&quot;resultat&quot;</span></span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>data_ex_long_4</span></code></pre></div>
<pre><code>##     lanceur  de resultat
##  1:     Kim de1        6
##  2:     Kim de1        5
##  3:     Kim de1        5
##  4:    &lt;NA&gt; de1        4
##  5:     Kim de1        4
##  6:     Kim de1        3
##  7:     Luc de1        3
##  8:     Luc de1        2
##  9:     Luc de1        2
## 10:     Luc de1        1
## 11:     Kim de2        2
## 12:     Kim de2       NA
## 13:     Kim de2        5
## 14:    &lt;NA&gt; de2        2
## 15:     Kim de2        3
## 16:     Kim de2        4
## 17:     Luc de2        4
## 18:     Luc de2        1
## 19:     Luc de2        1
## 20:     Luc de2        3</code></pre>
<p>Les arguments de <code>melt</code> portent des noms différents de ceux de <code>pivot_longer</code> (mis à part <code>data</code>), mais ils peuvent être définis de façon similaire :</p>
<ul>
<li><code>data</code> : le data table dont la mise en forme est à transformer;</li>
<li><code>measure.vars</code> : les noms des colonnes dans le jeu de données d’origine (<code>data</code>) sous la mise en forme large contenant les données à empiler dans une seule colonne sous la mise en forme longue;</li>
<li><code>variable.name</code> : le nom de la colonne dans la mise en forme longue servant à identifier les variables dont les valeurs dans la nouvelle colonne de valeurs empilées sont des valeurs;</li>
<li><code>value.name</code> : le nom de la colonne dans la mise en forme longue où seront empilées les valeurs provenant de plusieurs colonnes sous la mise en forme large.</li>
</ul>
</div>
<div id="exemple-de-transformation-vers-une-mise-en-forme-large-2" class="section level4" number="2.5.6.2">
<h4><span class="header-section-number">2.5.6.2</span> Exemple de transformation vers une mise en forme large :</h4>
<p></p>
<p>Comme pour la fonction <code>pivot_wider</code>, la fonction <code>dcast</code> a besoin que le jeu de données à transformer contienne une colonne pour identifier les individus. Voici donc un exemple d’utilisation de la fonction <code>dcast</code>, réalisé en utilisant comme jeu de données d’origine le data frame <code>data_ex_long_2</code> converti en data table.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>data_ex_long_2_dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(data_ex_long_2)</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>data_ex_large_4 <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ex_long_2_dt,</span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> lanceur <span class="sc">+</span> IDlancer <span class="sc">~</span> de,</span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">&quot;resultat&quot;</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>data_ex_large_4</span></code></pre></div>
<pre><code>##     lanceur IDlancer de1 de2
##  1:    &lt;NA&gt;       l3   4   2
##  2:     Kim      l10   4   3
##  3:     Kim       l6   3   4
##  4:     Kim       l7   5  NA
##  5:     Kim       l8   6   2
##  6:     Kim       l9   5   5
##  7:     Luc       l1   2   1
##  8:     Luc       l2   3   4
##  9:     Luc       l4   1   3
## 10:     Luc       l5   2   1</code></pre>
<p>Les arguments de <code>dcast</code> sont différents des arguments de toutes les fonctions de modification de mise en forme vues jusqu’à maintenant.</p>
<ul>
<li><code>data</code> : le data table dont la mise en forme est à transformer;</li>
<li><code>formula</code> : formule de la forme <code>LHS</code> ~ <code>RHS</code>, où
<ul>
<li><code>LHS</code> = noms des colonnes identifiant les individus ou à conserver telles quelles dans la sortie (séparées par <code>+</code> s’il y en a plus d’une),</li>
<li><code>RHS</code> = nom de la colonne identifiant les variables desquelles les valeurs empilées sont des mesures;</li>
</ul></li>
<li><code>value.var</code> = le nom de la colonne dans la mise en forme longue où sont empilées les valeurs qui doivent maintenant être réparties dans plusieurs colonnes.</li>
</ul>
<p>La fonction <code>dcast</code> va plus loin que la modification de mise en forme de jeux de données. Elle peut aussi agréger les données référant à un même individu en appliquant la fonction fournie à son argument <code>fun.aggregate</code>. Pour plus d’informations, voir les références.</p>
<hr />
</div>
</div>
</div>
</div>
<div id="résumé" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Résumé</h1>
<div id="r-de-base-principalement-les-packages-base-et-stats" class="section level4 unnumbered">
<h4>R de base (principalement les packages <code>base</code> et <code>stats</code>)</h4>
<p></p>
<div id="transformation-de-variables" class="section level5 unnumbered">
<h5>Transformation de variables</h5>
<ul>
<li>Ajout ou modification de variables dans un data frame :
<ul>
<li>assignation à une colonne, nouvelle pour un ajout,</li>
<li>fonction <code>transform</code>,</li>
<li>concaténation de colonnes avec <code>cbind</code> ou <code>data.frame</code>;</li>
</ul></li>
<li>Variable conditionnelle à une autre : <code>ifelse</code>;</li>
<li>Catégorisation d’une variable numérique : <code>cut</code>, <code>ave</code>;</li>
<li>Normalisation de valeurs : <code>scale</code>;</li>
<li>Manipulation de chaînes de caractères :
<ul>
<li><code>paste</code> : concatène des chaînes de caractères,</li>
<li><code>nchar</code> : calcule le nombre de caractères,</li>
<li><code>toupper</code> : transforme toutes les lettres en majuscules,</li>
<li><code>tolower</code> : transforme toutes les lettres en minuscules,</li>
<li><code>strsplit</code> : brise des chaînes de caractères, en coupant lors de la rencontre d’une certaine sous-chaîne de caractères,</li>
<li><code>substr</code> : extrait les caractères entre deux positions,</li>
<li><code>sub</code> ou <code>gsub</code> : remplacent la première ou toutes les occurrences d’une certaine sous-chaîne de caractères par une autre,</li>
<li><code>grep</code> et <code>grepl</code> : testent la présence d’une certaine sous-chaîne de caractères,</li>
<li><code>chartr</code> : remplace des caractères par d’autres,</li>
<li><code>iconv</code> : convertit l’encodage de chaîne de caractères;</li>
</ul></li>
<li>Manipulation de dates :
<ul>
<li><code>as.Date</code> : convertit une chaîne de caractère en format date,</li>
<li><code>Sys.setlocale</code> : permet de modifier les paramètres régionaux d’une session R (utile lorsque nous voulons convertir en format <code>Date</code> des chaînes de caractères contenant des noms de mois dans une langue autre que celle du système d’exploitation de notre ordinateur),</li>
<li><code>difftime</code> : calcule l’intervalle de temps entre deux dates,</li>
<li><code>Sys.Date</code> : retourne la date courante,</li>
<li><code>format</code> : permet de modifier le format d’une date.</li>
</ul></li>
</ul>
</div>
<div id="manipulation-de-jeux-de-données-1" class="section level5 unnumbered">
<h5>Manipulation de jeux de données</h5>
<p></p>
<div id="omission-dobservations-1" class="section level6 unnumbered">
<h6>Omission d’observations</h6>
<ul>
<li>Identifier les observations dupliquées : <code>duplicated</code>,</li>
<li>Retirer les observations dupliquées : <code>unique</code>.</li>
<li>Identifier les observations sans données manquantes : <code>complete.cases</code>,</li>
<li>Retirer les observations contenant au moins une donnée manquante : <code>na.omit</code>.</li>
</ul>
</div>
<div id="sélection-de-sous-ensembles-de-données-1" class="section level6 unnumbered">
<h6>Sélection de sous-ensembles de données</h6>
<ul>
<li>Sélectionner des observations (lignes) et des variables (colonnes) : opérateur <code>[</code>, fonction <code>subset</code>.</li>
</ul>
</div>
<div id="combinaison-de-données-1" class="section level6 unnumbered">
<h6>Combinaison de données</h6>
<ul>
<li>Concaténer des vecteurs, matrices ou data frames en lignes (lignes = observations dans un data frame) : <code>rbind</code>.</li>
<li>Concaténer des vecteurs, matrices ou data frames en colonnes (lignes = variables dans un data frame) : <code>cbind</code>, <code>data.frame</code>.</li>
<li>Fusionner par association deux jeux de données (jointure en identifiant les lignes correspondantes) : <code>merge</code>
<ul>
<li>argument <code>by</code>, ou arguments <code>by.x</code> et <code>by.y</code>, pour spécifier les variables d’association (celles à partir desquelles établir les correspondances entre les lignes);</li>
<li>argument <code>all</code>, ou arguments <code>all.x</code> et <code>all.y</code>, pour spécifier les lignes à conserver (donc le type de jointure à réaliser).</li>
</ul></li>
</ul>
</div>
<div id="modification-de-lordre-des-données-1" class="section level6 unnumbered">
<h6>Modification de l’ordre des données</h6>
<ul>
<li><code>rev</code> : renverse l’ordre des éléments;</li>
<li><code>sort</code> : ordonne les éléments d’un vecteur atomique
<ul>
<li>argument <code>decreasing = TRUE</code> pour ordre décroissant;</li>
</ul></li>
<li><code>[</code> : permet de réordonner les lignes ou les colonnes d’un objet à deux dimensions dans un ordre quelconque;</li>
<li><code>order</code> : retourne la permutation des données requise pour ordonner les données selon l’ordre spécifié <span class="math inline">\(\rightarrow\)</span> pour effectuer l’ordonnancement, il faut fournir le résultat retourné par <code>order</code> en argument à l’opérateur <code>[</code>
<ul>
<li>argument <code>decreasing = TRUE</code> pour ordre décroissant;</li>
</ul></li>
</ul>
</div>
<div id="changement-de-mise-en-forme-de-jeux-de-données-1" class="section level6 unnumbered">
<h6>Changement de mise en forme de jeux de données</h6>
<ul>
<li><code>t</code> : transpose des matrices</li>
<li><strong>Mise en forme « large »</strong> :
<ul>
<li>une seule ligne par individu (lorsque la largeur est maximale),</li>
<li>les vecteurs de mesures (valeurs) de certaines variables sont placés dans différentes colonnes.</li>
</ul></li>
<li><strong>Mise en forme « longue »</strong> :
<ul>
<li>plus d’une ligne par individu,</li>
<li>les vecteurs de mesures (valeurs) de certaines variables sont empilés dans une même colonne, les uns en dessous des autres,</li>
<li>comprend une ou des colonnes ayant pour but d’identifier à quelle variable est associée chaque donnée.</li>
</ul></li>
<li><code>stack</code> et <code>unstack</code> : modifient la mise en forme, fonctions simplistes</li>
<li><code>reshape</code> : modifie la mise en forme; les arguments de <code>reshape</code> sont les suivants
<ul>
<li>En lien avec le contexte :
<ul>
<li><code>data</code> : data frame à remettre en forme;</li>
<li><code>direction</code> : direction de la remise en forme (<code>"wide"</code> ou <code>"long"</code>).</li>
</ul></li>
<li>En lien avec les individus :
<ul>
<li><code>idvar</code> : nom(s) colonne(s) contenant les identifiants des individus;</li>
<li><code>ids</code> : identifiants des individus.</li>
</ul></li>
<li>En lien avec les variables :
<ul>
<li><code>timevar</code> : nom colonne contenant les identifiants des variables;</li>
<li><code>times</code> : identifiants des variables.</li>
</ul></li>
<li>En lien avec les valeurs :
<ul>
<li><code>v.names</code> : nom(s) colonne(s) contenant les valeurs empilées dans la mise en forme longue ou intermédiaire;</li>
<li><code>varying</code> : noms colonnes contenant les valeurs dans la mise en forme large ou intermédiaire.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="packages-du-tidyverse-principalement-dplyr-et-tidyr" class="section level4 unnumbered">
<h4>Packages du <code>tidyverse</code> (principalement <code>dplyr</code> et <code>tidyr</code>)</h4>
<ul>
<li>Transformation de variables : <code>mutate</code> du package <code>dplyr</code>.</li>
<li>Variable conditionnelle à une autre : <code>if_else</code> du package <code>dplyr</code>.</li>
<li>Manipulation de chaînes de caractères : package <code>stringr</code>.</li>
<li>Manipulation de dates : package <code>lubridate</code>.</li>
<li>Sélection de sous-ensembles de données :
<ul>
<li>sélection de lignes : <code>filter</code> du package <code>dplyr</code>;</li>
<li>sélection de colonnes : <code>select</code> du package <code>dplyr</code>;</li>
<li>sélection des lignes ne contenant aucune donnée manquante : <code>drop_na</code> du package <code>tidyr</code>.</li>
</ul></li>
<li>Combinaison de données :
<ul>
<li>concaténation de lignes : <code>bind_rows</code> ;</li>
<li>concaténation de colonnes : <code>bind_cols</code> du package <code>dplyr</code>;</li>
<li>fusion par association : <code>inner_join</code>, <code>full_join</code>, <code>left_join</code>, <code>right_join</code>, etc., du package <code>dplyr</code>.</li>
</ul></li>
<li>Modification de l’ordre des données : <code>arrange</code> du package <code>dplyr</code>,
<ul>
<li>encadrer les noms de variables (colonnes) d’un appel à la fonction <code>desc</code> du package <code>dplyr</code> pour obtenir un ordre décroissant.</li>
</ul></li>
<li>Changement de mise en forme de jeux de données :
<ul>
<li>transformation vers un format plus long : <code>pivot_longer</code> du package <code>tidyr</code>;</li>
<li>transformation vers un format plus large : <code>pivot_wider</code> du package <code>tidyr</code>.</li>
</ul></li>
</ul>
</div>
<div id="package-data.table" class="section level4 unnumbered">
<h4>Package <code>data.table</code></h4>
<ul>
<li>Transformation de variables : opérateur <code>:=</code> (modification par référence).</li>
<li>Variable conditionnelle à une autre : <code>fifelse</code>.</li>
<li>Sélection de sous-ensembles de données :
<ul>
<li>sélection de lignes et de colonnes : opérateur <code>[</code>, méthode <code>subset</code>;</li>
<li>sélection des lignes ne contenant aucune donnée manquante : méthode <code>na.omit</code>.</li>
</ul></li>
<li>Combinaison de données :
<ul>
<li>concaténation de lignes : <code>rbindlist</code>;</li>
<li>fusion par association : méthode <code>merge</code>.</li>
</ul></li>
<li>Modification de l’ordre des données (modification par référence) :
<ul>
<li>ordre des lignes : <code>setorder</code>;</li>
<li>ordre des colonnes : <code>setcolorder</code>.</li>
</ul></li>
<li>Changement de mise en forme de jeux de données :
<ul>
<li>transformation vers un format plus long : <code>melt</code>;</li>
<li>transformation vers un format plus large : <code>dcast</code>.</li>
</ul></li>
</ul>
</div>
<div id="tableau-résumé-des-fonctions-pour-la-transformation-de-mise-en-forme" class="section level4 unnumbered">
<h4>Tableau résumé des fonctions pour la transformation de mise en forme :</h4>
<table>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Package <code>utils</code></th>
<th>Package <code>stats</code></th>
<th>Package <code>tidyr</code></th>
<th>Package <code>data.table</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>large vers long</td>
<td><code>stack</code></td>
<td><code>reshape</code> (<code>direction = "long"</code>)</td>
<td><code>pivot_longer</code></td>
<td><code>melt</code></td>
</tr>
<tr class="even">
<td>long vers large</td>
<td><code>unstack</code></td>
<td><code>reshape</code> (<code>direction = "wide"</code>)</td>
<td><code>pivot_wider</code></td>
<td><code>dcast</code></td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
<div id="références" class="section level1 unnumbered">
<h1>Références</h1>
<ul>
<li>R Core Team (2020). <em>R: A language and environment for statistical computing</em>. R Foundation for Statistical Computing, Vienna, Austria. URL <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a></li>
</ul>
<p><strong>Sites web abordant le prétraitement de données en R</strong> :</p>
<ul>
<li><a href="http://larmarange.github.io/analyse-R/" class="uri">http://larmarange.github.io/analyse-R/</a></li>
<li><a href="http://www.cookbook-r.com/Manipulating_data/" class="uri">http://www.cookbook-r.com/Manipulating_data/</a></li>
<li><a href="https://www.statmethods.net/management/index.html" class="uri">https://www.statmethods.net/management/index.html</a></li>
</ul>
<div id="pour-aller-plus-loin-en-manipulation-de-jeux-de-données" class="section level4 unnumbered">
<h4>Pour aller plus loin en manipulation de jeux de données :</h4>
<ul>
<li>Billet de blogue : <a href="https://atrebas.github.io/post/2019-03-03-datatable-dplyr/">A data.table and dplyr tour</a></li>
</ul>
<p>Package <code>dplyr</code> :</p>
<ul>
<li>Page web du package sur le CRAN : <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a></li>
<li>Documentation du package : <a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a></li>
<li>Tutoriel d’étudiants : <a href="https://stt4230.rbind.io/tutoriels_etudiants/hiver_2016/manipuler_donnees_dplyr/">Manipulations de base sur un jeu de données</a></li>
</ul>
<p>Package <code>tidyr</code> :</p>
<ul>
<li>Page web du package sur le CRAN : <a href="https://CRAN.R-project.org/package=tidyr" class="uri">https://CRAN.R-project.org/package=tidyr</a></li>
<li>Documentation du package : <a href="https://tidyr.tidyverse.org/" class="uri">https://tidyr.tidyverse.org/</a></li>
<li>Tutoriel d’étudiants : <a href="https://stt4230.rbind.io/tutoriels_etudiants/hiver_2016/transformer_donnees_tidyr/">Réorganisation des données par concaténation et séparation d’observations</a></li>
<li>Article de blogue : <a href="https://www.garrickadenbuie.com/project/tidyexplain/">Tidy Animated Verbs</a></li>
<li>Présentation : <a href="https://speakerdeck.com/yutannihilation/a-graphical-introduction-to-tidyrs-pivot-star">A Graphical Introduction to tidyr’s pivot_*()</a></li>
</ul>
<p>Package <code>data.table</code> :</p>
<ul>
<li>Page web du package sur le CRAN : <a href="https://CRAN.R-project.org/package=data.table" class="uri">https://CRAN.R-project.org/package=data.table</a></li>
<li>Documentation du package : <a href="https://rdatatable.gitlab.io/data.table/index.html" class="uri">https://rdatatable.gitlab.io/data.table/index.html</a></li>
<li>Tutoriel d’étudiants : <a href="https://stt4230.rbind.io/tutoriels_etudiants/hiver_2017/data.table/">Fonctionnalités de l’opérateur <code>[</code> du package data.table</a></li>
</ul>
</div>
<div id="pour-aller-plus-loin-en-manipulation-de-chaînes-de-caractères" class="section level4 unnumbered">
<h4>Pour aller plus loin en manipulation de chaînes de caractères :</h4>
<p>Package <code>stringr</code> :</p>
<ul>
<li>Page web du package sur le CRAN : <a href="https://CRAN.R-project.org/package=stringr" class="uri">https://CRAN.R-project.org/package=stringr</a></li>
<li>Documentation du package : <a href="https://stringr.tidyverse.org/" class="uri">https://stringr.tidyverse.org/</a></li>
<li>Vignette : <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">Introduction to stringr</a></li>
<li>Tutoriel d’étudiants : <a href="https://stt4230.rbind.io/tutoriels_etudiants/hiver_2017/stringr/">Faciliter la manipulation de chaînes de caractères avec le package stringr</a></li>
</ul>
<p>Expressions régulières :</p>
<ul>
<li>Documentation R : <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html"><code>help(regexp)</code></a></li>
<li>Page Wikipédia : <a href="https://fr.wikipedia.org/wiki/Expression_r%C3%A9guli%C3%A8re">Expression régulière</a></li>
<li>Goulet, V. (2020). <em>Programmer avec R</em>. Université Laval, École d’actuariat. Section 11.3. URL <a href="https://vigou3.gitlab.io/programmer-avec-r/" class="uri">https://vigou3.gitlab.io/programmer-avec-r/</a></li>
<li>Wickham, H. et Grolemund, G. (2016). <em>R for Data Science</em>. O’Reilly Media, Inc., Chapitre 14. URL <a href="https://r4ds.had.co.nz/strings.html" class="uri">https://r4ds.had.co.nz/strings.html</a></li>
<li>Feuille de triche : <a href="https://rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">Basic regular expressions in R</a></li>
</ul>
<p>Autres références en manipulation de chaînes de caractères en R :</p>
<ul>
<li>Sanchez, G. (2013). Handling and Processing Strings in R. Trowchez Editions. Berkeley. URL <a href="http://gastonsanchez.com/Handling_and_Processing_Strings_in_R.pdf" class="uri">http://gastonsanchez.com/Handling_and_Processing_Strings_in_R.pdf</a></li>
<li>Billet de blogue : <a href="https://jozefhajnala.gitlab.io/r/r007-string-manipulation/">How to work with strings in base R - An overview of 20+ methods for daily use</a></li>
</ul>
</div>
<div id="pour-aller-plus-loin-en-manipulation-de-dates" class="section level4 unnumbered">
<h4>Pour aller plus loin en manipulation de dates :</h4>
<ul>
<li>Documentation R à propos de tous les format possibles : <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/strptime.html"><code>help(strptime)</code></a>,</li>
<li>Billet de blogue : <a href="http://www.noamross.net/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html">Using Dates and Times in R</a></li>
</ul>
<p>Package <code>lubridate</code> :</p>
<ul>
<li>Page web du package sur le CRAN : <a href="https://CRAN.R-project.org/package=lubridate" class="uri">https://CRAN.R-project.org/package=lubridate</a></li>
<li>Documentation du package : <a href="https://lubridate.tidyverse.org/" class="uri">https://lubridate.tidyverse.org/</a></li>
<li>Vignette : <a href="https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html">Do more with dates and times in R</a></li>
<li>Tutoriel d’étudiants : <a href="https://stt4230.rbind.io/tutoriels_etudiants/hiver_2017/lubridate/">Manipuler facilement vos formats date avec lubridate</a></li>
</ul>
</div>
<div id="pour-manipuler-des-data-frames-r-en-utilisant-le-langage-sql" class="section level4 unnumbered">
<h4>Pour manipuler des data frames R en utilisant le langage SQL :</h4>
<ul>
<li>Package <code>sqldf</code> : <a href="https://CRAN.R-project.org/package=sqldf" class="uri">https://CRAN.R-project.org/package=sqldf</a></li>
</ul>
<hr />
</div>
</div>
<div id="annexe" class="section level1 unnumbered">
<h1>Annexe</h1>
<div id="exemples-supplémentaires-de-changement-de-mise-en-forme" class="section level2 unnumbered">
<h2>Exemples supplémentaires de changement de mise en forme</h2>
<p>Voici quelques exemples supplémentaires de changements de mise en forme effectués avec la fonction <code>reshape</code> ou avec le package <code>tidyr</code>.</p>
<p>Données utilisées :</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>plants_large</span></code></pre></div>
<pre><code>##   Plant Hauteur_Temps1 Hauteur_Temps2 Diametre_Temps1 Diametre_Temps2
## 1     a             67             69              15              15
## 2     b             59             65              16              17
## 3     c             62             66              13              14</code></pre>
<div id="mise-en-forme-large-pure-vers-mise-en-forme-intermédiaire" class="section level4 unnumbered">
<h4>Mise en forme large pure vers mise en forme intermédiaire</h4>
<p></p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec reshape :</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_large,</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;Plant&quot;</span>,</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;Temps&quot;</span>,</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">&quot;Hauteur&quot;</span>, <span class="st">&quot;Diametre&quot;</span>),</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;Diametre_Temps1&quot;</span>, <span class="st">&quot;Hauteur_Temps1&quot;</span>, <span class="st">&quot;Diametre_Temps2&quot;</span>, <span class="st">&quot;Hauteur_Temps2&quot;</span>)</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##     Plant Temps Hauteur Diametre
## a.1     a     1      67       15
## b.1     b     1      59       16
## c.1     c     1      62       13
## a.2     a     2      69       15
## b.2     b     2      65       17
## c.2     c     2      66       14</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pivot_longer :</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Il faut réaliser la transformation en deux temps, </span></span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="co"># parce que l&#39;argument values_to accepte seulement un nom.</span></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>hauteur_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_large,</span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(Hauteur_Temps1, Hauteur_Temps2),</span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;Temps&quot;</span>,</span>
<span id="cb314-8"><a href="#cb314-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_prefix =</span> <span class="st">&quot;Hauteur_Temps&quot;</span>,</span>
<span id="cb314-9"><a href="#cb314-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span>  <span class="st">&quot;Hauteur&quot;</span></span>
<span id="cb314-10"><a href="#cb314-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb314-11"><a href="#cb314-11" aria-hidden="true" tabindex="-1"></a>diametre_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb314-12"><a href="#cb314-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_large,</span>
<span id="cb314-13"><a href="#cb314-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(Diametre_Temps1, Diametre_Temps2),</span>
<span id="cb314-14"><a href="#cb314-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;Temps&quot;</span>,</span>
<span id="cb314-15"><a href="#cb314-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_prefix =</span> <span class="st">&quot;Diametre_Temps&quot;</span>,</span>
<span id="cb314-16"><a href="#cb314-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span>  <span class="st">&quot;Diametre&quot;</span>,</span>
<span id="cb314-17"><a href="#cb314-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb314-18"><a href="#cb314-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Il ne reste qu&#39;à fusionner les deux `data frames tibbles </span></span>
<span id="cb314-19"><a href="#cb314-19" aria-hidden="true" tabindex="-1"></a><span class="co"># et à éliminer des variables.</span></span>
<span id="cb314-20"><a href="#cb314-20" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(</span>
<span id="cb314-21"><a href="#cb314-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">select</span>(hauteur_long, Plant, Temps, Hauteur),</span>
<span id="cb314-22"><a href="#cb314-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">select</span>(diametre_long, Plant, Temps, Diametre)</span>
<span id="cb314-23"><a href="#cb314-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;Plant&quot;, &quot;Temps&quot;)</code></pre>
<pre><code>## # A tibble: 6 x 4
##   Plant Temps Hauteur Diametre
##   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 a     1          67       15
## 2 a     2          69       15
## 3 b     1          59       16
## 4 b     2          65       17
## 5 c     1          62       13
## 6 c     2          66       14</code></pre>
</div>
<div id="mise-en-forme-large-pure-vers-mise-en-forme-longue-pure" class="section level4 unnumbered">
<h4>Mise en forme large pure vers mise en forme longue pure</h4>
<p></p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec reshape :</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_large,</span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;Plant&quot;</span>,</span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;Variable&quot;</span>,</span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="st">&quot;Hauteur_Temps1&quot;</span>, <span class="st">&quot;Hauteur_Temps2&quot;</span>, <span class="st">&quot;Diametre_Temps1&quot;</span>, <span class="st">&quot;Diametre_Temps2&quot;</span>),</span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;Valeur&quot;</span>,</span>
<span id="cb317-9"><a href="#cb317-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;Hauteur_Temps1&quot;</span>, <span class="st">&quot;Hauteur_Temps2&quot;</span>, <span class="st">&quot;Diametre_Temps1&quot;</span>, <span class="st">&quot;Diametre_Temps2&quot;</span>)</span>
<span id="cb317-10"><a href="#cb317-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##                   Plant        Variable Valeur
## a.Hauteur_Temps1      a  Hauteur_Temps1     67
## b.Hauteur_Temps1      b  Hauteur_Temps1     59
## c.Hauteur_Temps1      c  Hauteur_Temps1     62
## a.Hauteur_Temps2      a  Hauteur_Temps2     69
## b.Hauteur_Temps2      b  Hauteur_Temps2     65
## c.Hauteur_Temps2      c  Hauteur_Temps2     66
## a.Diametre_Temps1     a Diametre_Temps1     15
## b.Diametre_Temps1     b Diametre_Temps1     16
## c.Diametre_Temps1     c Diametre_Temps1     13
## a.Diametre_Temps2     a Diametre_Temps2     15
## b.Diametre_Temps2     b Diametre_Temps2     17
## c.Diametre_Temps2     c Diametre_Temps2     14</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pivot_longer :</span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_large,</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(Hauteur_Temps1, Hauteur_Temps2, Diametre_Temps1, Diametre_Temps2),</span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;Variable&quot;</span>,</span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span>  <span class="st">&quot;Valeur&quot;</span></span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    Plant Variable        Valeur
##    &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;
##  1 a     Hauteur_Temps1      67
##  2 a     Hauteur_Temps2      69
##  3 a     Diametre_Temps1     15
##  4 a     Diametre_Temps2     15
##  5 b     Hauteur_Temps1      59
##  6 b     Hauteur_Temps2      65
##  7 b     Diametre_Temps1     16
##  8 b     Diametre_Temps2     17
##  9 c     Hauteur_Temps1      62
## 10 c     Hauteur_Temps2      66
## 11 c     Diametre_Temps1     13
## 12 c     Diametre_Temps2     14</code></pre>
</div>
<div id="mise-en-forme-intermédiaire-vers-mise-en-forme-longue-pure" class="section level4 unnumbered">
<h4>Mise en forme intermédiaire vers mise en forme longue pure</h4>
<p></p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec reshape :</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_inter,</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>,</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">&quot;Plant&quot;</span>, <span class="st">&quot;Temps&quot;</span>), <span class="co"># n&#39;accepte pas &quot;Plant&quot; seul, car la colonne</span></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;Variable&quot;</span>,        <span class="co"># contient des combinaisons répétées</span></span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="st">&quot;Hauteur&quot;</span>, <span class="st">&quot;Diametre&quot;</span>),</span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;Valeur&quot;</span>,</span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;Hauteur&quot;</span>, <span class="st">&quot;Diametre&quot;</span>)</span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##              Plant Temps Variable Valeur
## a.1.Hauteur      a     1  Hauteur     67
## b.1.Hauteur      b     1  Hauteur     59
## c.1.Hauteur      c     1  Hauteur     62
## a.2.Hauteur      a     2  Hauteur     69
## b.2.Hauteur      b     2  Hauteur     65
## c.2.Hauteur      c     2  Hauteur     66
## a.1.Diametre     a     1 Diametre     15
## b.1.Diametre     b     1 Diametre     16
## c.1.Diametre     c     1 Diametre     13
## a.2.Diametre     a     2 Diametre     15
## b.2.Diametre     b     2 Diametre     17
## c.2.Diametre     c     2 Diametre     14</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pivot_longer :</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_inter,</span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(Hauteur, Diametre),</span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;Variable&quot;</span>,</span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span>  <span class="st">&quot;Valeur&quot;</span></span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    Plant Temps Variable Valeur
##    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 a         1 Hauteur      67
##  2 a         1 Diametre     15
##  3 b         1 Hauteur      59
##  4 b         1 Diametre     16
##  5 c         1 Hauteur      62
##  6 c         1 Diametre     13
##  7 a         2 Hauteur      69
##  8 a         2 Diametre     15
##  9 b         2 Hauteur      65
## 10 b         2 Diametre     17
## 11 c         2 Hauteur      66
## 12 c         2 Diametre     14</code></pre>
</div>
<div id="mise-en-forme-longue-pure-vers-mise-en-forme-intermédiaire" class="section level4 unnumbered">
<h4>Mise en forme longue pure vers mise en forme intermédiaire</h4>
<p></p>
<p>Il faut partir de <code>plants_long</code>.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec reshape :</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_long,</span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">&quot;Plant&quot;</span>, <span class="st">&quot;Temps&quot;</span>),</span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;Variable&quot;</span>,</span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;Valeur&quot;</span></span>
<span id="cb325-8"><a href="#cb325-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   Plant Temps Valeur.Hauteur Valeur.Diametre
## 1     a     1             67              15
## 2     b     1             59              16
## 3     c     1             62              13
## 4     a     2             69              15
## 5     b     2             65              17
## 6     c     2             66              14</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pivot_wider :</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_long,</span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> Variable,</span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> Valeur</span>
<span id="cb327-6"><a href="#cb327-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   Plant Temps Hauteur Diametre
##   &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 a         1      67       15
## 2 b         1      59       16
## 3 c         1      62       13
## 4 a         2      69       15
## 5 b         2      65       17
## 6 c         2      66       14</code></pre>
</div>
<div id="mise-en-forme-longue-pure-vers-mise-en-forme-large-pure" class="section level4 unnumbered">
<h4>Mise en forme longue pure vers mise en forme large pure</h4>
<p></p>
<p>Il faut partir de <code>plants_long_2</code>.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec reshape :</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_long_2,</span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;Plant&quot;</span>,</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;Variable&quot;</span>,</span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;Valeur&quot;</span></span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   Plant Valeur.Hauteur_Temps1 Valeur.Hauteur_Temps2 Valeur.Diametre_Temps1
## 1     a                    67                    69                     15
## 2     b                    59                    65                     16
## 3     c                    62                    66                     13
##   Valeur.Diametre_Temps2
## 1                     15
## 2                     17
## 3                     14</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pivot_wider :</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_long_2,</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> Variable,</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> Valeur</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Plant Hauteur_Temps1 Hauteur_Temps2 Diametre_Temps1 Diametre_Temps2
##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
## 1 a                 67             69              15              15
## 2 b                 59             65              16              17
## 3 c                 62             66              13              14</code></pre>
</div>
<div id="mise-en-forme-intermédiaire-vers-mise-en-forme-large-pure" class="section level4 unnumbered">
<h4>Mise en forme intermédiaire vers mise en forme large pure</h4>
<p></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec reshape :</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_inter,</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;Plant&quot;</span>,</span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;Temps&quot;</span>,</span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">&quot;Hauteur&quot;</span>, <span class="st">&quot;Diametre&quot;</span>)</span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   Plant Hauteur.1 Diametre.1 Hauteur.2 Diametre.2
## 1     a        67         15        69         15
## 2     b        59         16        65         17
## 3     c        62         13        66         14</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pivot_wider :</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(</span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> plants_inter,</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> Temps,</span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="fu">c</span>(Hauteur, Diametre)</span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Plant Hauteur_1 Hauteur_2 Diametre_1 Diametre_2
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 a            67        69         15         15
## 2 b            59        65         16         17
## 3 c            62        66         13         14</code></pre>
</div>
</div>
</div>
